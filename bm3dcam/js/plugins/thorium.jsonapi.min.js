/*!
 * Thorium JSON API functions for framework7 projects
 * Version 4.0 january 2024
 * framework7 v8.x (https://framework7.io) MIT Licensed
 * Thorium builder Â© Copyright 2018-2024 Nymphide Lab, All Rights Reserved.
*/
var jsonApiPlugin={name:"Thorium Builder JSON API Plugin",bundleid:"com.thoriumbuilder.jsonapi",version:"4.0",currentRepeaterId:null,currentDisplayerId:null,dataset:null,currentKey:null,currentData:null,parseDataRecursive:function(e,t,i){for(var e in thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Parsing Data "),t){if("object"==typeof t[e]&&null!==t[e])if(Array.isArray(t[e]))i[e.replaceAll(" ","_")]=t[e];else jsonApiPlugin.parseDataRecursive(e,t[e],i);else i[e.replaceAll(" ","_")]=t[e]}return i},initDisplayerMap:function(e,t,i){if(t&&i){var a=e.getAttribute("data-engine")||null;if(a||"undefined"==typeof openStreetMapPlugin?a||"undefined"==typeof googleMapPlugin||(a="googlemap"):a="osm",thoriumapi.logEvent(0,"[com.thoriumbuilder.dbexpress.maps] Loading Displayer Map with Engine ["+a+"]"),"osm"==a&&"undefined"!=typeof openStreetMapPlugin){var r=openStreetMapPlugin.initMap(e.id);if(r){var n={};n.latitude=t,n.longitude=i,n.name=t+";"+i,openStreetMapPlugin.addMarkerAt(r,t,i,n),r.panTo(new L.LatLng(t,i))}}else if("googlemap"==a&&"undefined"!=typeof googleMapPlugin){googleMapPlugin.initializeMap(e.id);var l=new google.maps.LatLng(parseFloat(t),parseFloat(i));googleMapPlugin.addMarker(e.map,l,t+";"+i),e.map.setCenter(l)}}else e.style.display="none"},setGeoPointMapContent:function(e,t){var i=e.getAttribute("data-latitude")||null,a=e.getAttribute("data-longitude")||null,r=e.getAttribute("data-geopoint")||null;if(i&&a){var n=t[i],l=t[a];n&&l?jsonApiPlugin.initDisplayerMap(e,n,l):e.style.display="none"}else if(r&&r.length>0){var o=t[r];if(o&&o.length>0){const t=o.replaceAll("{","").replaceAll("}","").split(",");2==t.length?jsonApiPlugin.initDisplayerMap(e,t[0],t[1]):e.style.display="none"}else e.style.display="none"}else e.style.display="none"},setDisplayerDataContent:function(e,t){if(t){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Set Content for Displayer with ID ["+e.id+"]"),$("#"+e.id+" [data-json-value]").each((function(e){var i,a=e.tagName.toLowerCase(),r=e.className.toLowerCase(),n=e.getAttribute("data-json-value");if(i=t[n],thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Set Content for field ["+n+"]"),["embed-responsive-item"].indexOf(r)>-1&&"audio"!=a&&"video"!=a){var l=e.getAttribute("data-httproot")||"";i?e.style.backgroundImage="url('"+l+i+"')":e.closest(".embed-responsive").style.display="none"}else if(["source"].indexOf(a)>-1||"audio"==a||"video"==a){l=e.getAttribute("data-httproot")||"";i?e.setAttribute("src",l+i):e.style.display="none"}else if("img"==a)if(i){l=e.getAttribute("data-httproot")||"";e.setAttribute("src",l+i)}else e.setAttribute("src","img/defaultimg.png");else if(i){var o=e.innerHTML;o&&n&&(e.innerHTML=o.replaceAll("{"+n+"}",i)),"a"==a&&(o=e.getAttribute("href"))&&(o=o.replaceAll("{"+n+"}",i),e.setAttribute("href",o))}else e.style.display="none"}));var i=e.querySelector(".jsonapi-geopoint-map");i&&jsonApiPlugin.setGeoPointMapContent(i,t),e.setAttribute("data-loaded",!0),$("#"+e.id).show(),app.emit("jsonDisplayerInitialized",e,t),app.emit("displayerDataLoaded[#"+e.id+"]",e,t),app.preloader.hide()}else thoriumapi.logEvent(1,"[com.thoriumbuilder.jsonapi] unable to set Displayer contents, undefined data")},getRepeaterTemplate:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Get Template for Repeater with ID ["+e.id+"]");var t=e.outerHTML;e.style.display=null,$("#"+e.id+" .json-field p, .json-field .text-link").each((function(e){var t=e.getAttribute("data-json-value")||"",i=e.tagName.toLowerCase(),a=e.innerHTML;a&&t&&(e.innerHTML=a.replaceAll("{"+t+"}","{{"+t+"}}")),"a"==i&&(a=e.getAttribute("href"))&&t&&(a=a.replaceAll("{"+t+"}","{{"+t+"}}"),e.setAttribute("href",a))})),$("#"+e.id+" .json-field img,video,source").each((function(e){var t=e.getAttribute("data-json-value")||"",i=e.getAttribute("data-httproot")||"";e.setAttribute("src",i+"{{"+t+"}}")})),$("#"+e.id+" .json-field .embed-responsive-item").each((function(e){var t=e.getAttribute("data-json-value")||"",i=e.getAttribute("data-httproot")||"";e.setAttribute("style","background-image:url('"+i+"{{"+t+"}}') , url('img/defaultimg.png')")})),e.removeAttribute("id"),e.removeAttribute("data-template-height"),e.classList.remove("templaterow");var i=e.outerHTML;return e.outerHTML=t,i},getCollectionRow:function(e,t,i){for(var a in thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Get Collection Rows"),t){var r;if("object"==typeof t[a]&&null!==t[a]){if(!Array.isArray(t[a]))r=e.length>0?e+"."+a:a,i=jsonApiPlugin.getCollectionRow(r,t[a],i)}else if(r=e.length>0?e+"."+a:a){r=r.replaceAll(" ","_");var n=t[a];n||0==n||(n=""),i=(i=i.replaceAll("{{"+r+"}}",n)).replaceAll("{"+r+"}",n)}}return i},flattenObj:function(e){var t={};for(var i in e){if(!e.hasOwnProperty(i))continue;const n=e[i];if("object"==typeof n){t[i]=n;var a=jsonApiPlugin.flattenObj(n);for(var r in a)a.hasOwnProperty(r)&&(t[i+"."+r]=a[r])}else t[i]=n}return t},setRepeaterDataContent:function(e,t){var i,a=e.getAttribute("data-displaymode")||0,r=document.getElementById("template-"+e.id);if(!(r||(i=$("#"+e.id).data("template"))&&0!=i.length))return thoriumapi.logEvent(1,"[com.thoriumbuilder.jsonapi] No Template found for object with ID ["+e.id+"]"),void $("#"+e.id).hide();if(i&&0!=i.length||(i=1!=a?jsonApiPlugin.getRepeaterTemplate(r):r.outerHTML,$("#"+e.id).data("template",i)),"1"!=a){var n=[];for(const[e,i]of Object.entries(t)){var l=jsonApiPlugin.flattenObj(i);n.push(l)}thoriumCorePlugin.virtuallist.renderVirtualListFromData(e,n,i)}else if(t.length>0){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Render Collection for Repeater with ID ["+e.id+"]"),$("#"+e.id).data("items",t);var o,s=e.parentNode.getAttribute("data-img-root")||"",p=0;for(var u in t)o=(o=(o=(o=(o=(o=jsonApiPlugin.getCollectionRow("",t[u],i)).replace("url({data-img-root})","url(./img/defaultimg.png)")).replaceAll("templaterow","")).replaceAll("template-"+e.id,"template-"+e.id+"-"+p)).replaceAll("{data-img-root}",s)).replaceAll("'"+s+"'","./img/defaultimg.png"),e.innerHTML=e.innerHTML+o,p+=1;e.setAttribute("data-loaded",!0),e.setAttribute("data-count",t.length);var d=document.querySelector(".searchbar[data-search-container='#"+e.id+"']");if(d){var c=app.searchbar.get(d);c&&app.searchbar.destroy(d),c=app.searchbar.create({el:d,customSearch:!0,removeDiacritics:!0,on:{search:function(t){for(var i=e.querySelectorAll(".collection-item "),a=0;a<i.length;a++){var r=i[a];r.innerText.toLowerCase().includes(t.query.toLowerCase())?r.classList.remove("hidden"):r.classList.add("hidden")}}}})}}var g=e.closest(".json-virtual-list")||null;app.emit("jsonRepeaterInitialized",g,t),app.emit("repeaterDataLoaded[#"+g.id+"]",g,t)},getChildrenProperty:function(e,t){var i;for(var a in e){if(a==t){i=e[a];break}if(e.hasOwnProperty(a)&&!i&&"object"==typeof e[a]&&null!==e[a]&&(i=jsonApiPlugin.getChildrenProperty(e[a],t)),i)break}if(null!=i)return i},getRepeaterData:function(e,t,i,a){a=a||!1;var r="",n=[];r=t;var l=$("#"+e.id);if(l){var o=app.virtualList.get(l);o&&app.virtualList.destroy(o),thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Get data for Repeater with ID ["+e.id+"] from url ["+r+"]");var s=l.closest(".page-content");if(s&&(app.preloader.hide(),1==kShowPreloader&&app.preloader.showIn(s),setTimeout((function(){s&&app.preloader.hideIn(s)}),4e3)),jsonApiPlugin.currentRepeaterId=null,e){var p=e.closest(".json-virtual-list");p&&(jsonApiPlugin.currentRepeaterId=p.id)}var u={},d={},c=e.getAttribute("data-api-method")||"get",g=e.getAttribute("data-api_referrer")||"",m=e.getAttribute("data-api-referrerpolicy")||"",h=e.getAttribute("data-api-mode")||"",f=e.getAttribute("data-api-cache")||"",v=e.getAttribute("data-api-credentials")||"",y=e.getAttribute("data-api-redirect")||"",A=e.getAttribute("data-api-contenttype")||"application/json",b=e.getAttribute("data-api-accept")||"application/json",j=e.getAttribute("data-api-authorization")||"";e.getAttribute("data-api-header_key"),e.getAttribute("data-api-header_value");u.method=c,g.length>0&&(u.referrer=g),m.length>0&&(d.referrerpolicy=m),h.length>0&&(u.mode=h),f.length>0&&(u.cache=f),v.length>0&&(u.credentials=v),y.length>0&&(d.redirect=y),d["Content-Type"]=A,d.Accept=b,j.length>0&&(d.Authorization=thoriumapi.replaceDynamicVariables(j)),u.headers=d;var k=window.callback_repeater_before_load,D=[u];"function"==typeof k&&(u=k.apply(this,D));var P=e.getAttribute("data-dummy-param")||null;if(P&&"true"==P){var w=Math.floor(Date.now()/1e3);r=-1==r.indexOf("?")?r+"?rnd="+w:r+"&rnd="+w}r=thoriumapi.replaceDynamicVariables(r),fetch(r,u).then((function(t){for(var a of t.headers.entries())thoriumapi.logEvent(0,"[com.thoriumbuilder.core] fetch api returned headers "+a[0]+": "+a[1]);t.text().then((a=>{if(thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Got Response from url ["+r+"]"),0==a.length)return thoriumapi.logEvent(1,"[com.thoriumbuilder.jsonapi] Empty Result. Maybe a CORS issue. Status ["+t.status+"] :"+t.statusText),e.classList.remove("loadingdata"),void(s&&app.preloader.hideIn(s));var l;try{l=JSON.parse(a)}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.jsonapi] Error "+e.code+" "+e.message+". Returned Result: "+a),app.emit("jsonDataloadError",$(this),e),s&&app.preloader.hideIn(s),void app.dialog.alert(e.message+" "+a)}var o=e.getAttribute("data-function")||null;if(o){var p=window[o],u=[l];"function"==typeof p&&(l=p.apply(this,u))}if(!l)return s&&app.preloader.hideIn(s),app.preloader.hide(),void thoriumapi.logEvent(1,"[com.thoriumbuilder.jsonapi] Empty Dataset: "+a);var d,c=0,g={};if("object"==typeof l&&i?d=jsonApiPlugin.getChildrenProperty(l,i):l&&(d=i?l[i]:l),d)for(var m in d)(g=d[m]).dataindex=c,c+=1,n.push(g);else Object.keys(l).length>0?(thoriumapi.logEvent(2,"[com.thoriumbuilder.jsonapi] "+i+"is an invalid Root name"),app.dialog.alert(i+" is an invalid Root name (returned result: "+a+")")):thoriumapi.logEvent(1,"[com.thoriumbuilder.jsonapi] Invalid Result: "+a);jsonApiPlugin.setRepeaterDataContent(e,n),app.emit("jsonDataloadSuccess",$(this),e,n),s&&app.preloader.hideIn(s),app.preloader.hide()})).catch((function(t){app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.jsonapi] "+t.message),e.classList.remove("loadingdata"),$("#"+e.id).hide(),app.dialog.alert(t.message)}))})).catch((function(t){app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.jsonapi] "+t.message),s&&app.preloader.hideIn(s),$("#"+e.id).hide(),app.emit("jsonDataloadError",$(this),t),0==app.online?thoriumapi.showNotification("Internet connection lost"):app.dialog.alert(t.message)}))}},reloadRepeater:function(e){var t=document.getElementById(e);if(e){var i=t.querySelector(".json-virtual-list-content");if(i){var a=i.getAttribute("data-source")||null;"js/json/"==a&&(a=null),jsonApiPlugin.currentKey&&a&&(a=a.replaceAll("{key}",jsonApiPlugin.currentKey));var r=i.getAttribute("data-root-field")||null;a&&jsonApiPlugin.getRepeaterData(i,a,r,!0)}}},initAllRepeaters:function(e,t){t=t||!1,thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Checking Repeaters State");for(var i=document.querySelectorAll(".json-virtual-list-content"),a=0;a<i.length;a++){var r=i[a];if("true"!=r.getAttribute("data-loaded")){var n=r.getAttribute("data-source")||null;"js/json/"==n&&(n=null),e&&n&&(n=n.replaceAll("{key}",e));var l=r.getAttribute("data-root-field")||null;if(n){jsonApiPlugin.getRepeaterData(r,n,l,t);const e=document.querySelector("#view-main");e&&(e.style.display=!0)}}}i&&0!=i.length||app.preloader.hide()},handleFetchError:function(e,t,i,a){thoriumapi.logEvent(2,"[com.thoriumbuilder.jsonapi] url ["+i+"] returned ["+t+"] "),app.emit("jsonDataloadError",a,t),0==app.online&&thoriumapi.showNotification("Internet connection lost"),app.dialog.alert(t)},getDisplayerData:function(e,t,i){i.style.opacity=0;var a=e.replaceAll("{key}",t);thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Get Displayer Data from url ["+a+"]");var r={},n={},l=!1;r.method="GET",kMode.length>0&&(r.mode=kMode),kCache.length>0&&(r.cache=kCache),kCredentials.length>0&&(r.credentials=kCredentials),kContenttype.length>0&&(n["Content-Type"]=kContenttype,l=!0),kRedirect.length>0&&(n.redirect=kRedirect,l=!0),kReferrerpolicy.length>0&&(n.referrerpolicy=kReferrerpolicy,l=!0),kAuthorization.length>0&&(n.Authorization=kAuthorization,l=!0),1==l&&(r.headers=n),jsonApiPlugin.currentDisplayerId=null,i&&(jsonApiPlugin.currentDisplayerId=i.id);var o=window.callback_displayer_before_load,s=[r];"function"==typeof o&&(r=o.apply(this,s)),a=thoriumapi.replaceDynamicVariables(a),fetch(a,r).then((function(e){200===e.status?e.text().then((e=>{var t;try{t=JSON.parse(e)}catch(e){return void jsonApiPlugin.handleFetchError(e.errcode,e.message,a,i)}var r={};for(var n in t){if("object"==typeof t[n]&&null!==t[n])r=jsonApiPlugin.parseDataRecursive(n,t[n],r);else r[n.replaceAll(" ","_")]=t[n]}thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Data loaded from url ["+a+"]"),app.emit("jsonDataloadSuccess",$(this),i,r),jsonApiPlugin.setDisplayerDataContent(i,r),$("#"+i.id).data("item",r),i.style.opacity=0,$("#"+i.id).show(),i.style.opacity=1})).catch((function(e){jsonApiPlugin.handleFetchError(e.errcode,e.message,a,i)})):jsonApiPlugin.handleFetchError(e.status,"Invalid Server Response",a,i)})).catch((function(e){jsonApiPlugin.handleFetchError(e.errcode,e.message,a,i)}))},repeaterDblLineClick:function(e,t){var i=t.attr("data-index")||null,a=t.attr("data-key")||null;if(i){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Detect Double Click/Touch on line ["+i+"]");var r=t.parents(".json-virtual-list-content");if(r){var n=app.virtualList.get("#"+r[0].id),l=r.attr("data-detail")||null,o=n.items[i];if(l&&(e.preventDefault(),o)){var s=app.view;if(s&&s.length>0)try{var p="/"+l+"/?rowindex="+i+"&key="+a+"&data="+encodeURIComponent(JSON.stringify(o));p.length<=2083?(jsonApiPlugin.dataset=null,s[0].router.navigate(p)):(jsonApiPlugin.dataset=JSON.stringify(o),s[0].router.navigate("/"+l+"/?rowindex="+i+"&key="+a))}catch(e){app.dialog.alert(e.message)}}var u=t.closest(".json-virtual-list")||null;app.emit("jsonRepeaterLineDblClick",u,i,a,o,l)}}},repeaterLineClick:function(e,t){var i=t.attr("data-index")||null,a=t.attr("data-key")||null;if(i){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Detect Click/Touch on line ["+i+"]");var r=t.parents(".json-virtual-list-content");if(r){var n=app.virtualList.get("#"+r[0].id),l=r.attr("data-detail")||null,o=n.items[i];if(l&&(e.preventDefault(),o)){var s=app.view;if(s&&s.length>0)try{var p="/"+l+"/?rowindex="+i+"&key="+a+"&data="+encodeURIComponent(JSON.stringify(o));p.length<=2083?(jsonApiPlugin.dataset=null,s[0].router.navigate(p)):(jsonApiPlugin.dataset=JSON.stringify(o),s[0].router.navigate("/"+l+"/?rowindex="+i+"&key="+a))}catch(e){app.dialog.alert(e.message)}}var u=t.closest(".json-virtual-list")||null;app.emit("jsonRepeaterLineClick",u,i,a,o,l);var d=r[0].closest(".json-repeater")||null;d&&app.emit("lineChange[#"+d.id+"]",e,d,i,o)}}},collectionrepeaterLineClick:function(e,t){var i=t.attr("data-index")||null,a=t.attr("data-key")||null;if(i){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Detect Click/Touch on line ["+i+"]");var r=t.parents(".json-virtual-list-content");if(r){var n=r.data("items"),l=r.attr("data-detail")||null,o=n[i],s=app.view;if(s&&s.length>0){var p=t.closest(".json-virtual-list")||null;app.emit("jsonRepeaterLineClick",p,i,a,o,l),s[0].router.navigate("/"+l+"/?rowindex="+i+"&data="+encodeURIComponent(JSON.stringify(o))+"&key="+a)}}}},initAllDisplayers:function(e,t){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Checking JSON Displayer State");for(var i=document.querySelectorAll(".json-form"),a=0;a<i.length;a++){var r=i[a];if("true"!=r.getAttribute("data-loaded")){var n=r.getAttribute("data-custom-api")||null;n?jsonApiPlugin.getDisplayerData(n,e,r):jsonApiPlugin.setDisplayerDataContent(r,t)}}i&&0!=i.length||app.preloader.hide()},setRepeaterFilter:function(e,t){var i=t.attr("data-filter-virtuallist")||null;if(app.virtualList.get("#"+i)){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Set New Filter for Repeater with ID ["+i+"]"),document.getElementById(i).setAttribute("data-loaded",!1),document.getElementById(i).setAttribute("data-count",0);var a=t.attr("data-source");a&&(document.getElementById(i).setAttribute("data-source",a),jsonApiPlugin.initAllRepeaters(null))}else{var r="An error occured, the Json Repeater is not initialized";thoriumapi.logEvent(2,"[com.thoriumbuilder.jsonapi] "+r),app.dialog.alert(r)}},repeaterLineButtonClick:function(e,t){var i=t.attr("data-index")||null,a=t.attr("data-key")||null,r=t.attr("data-target")||null,n=t.attr("data-transition")||null;if(i){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Detect Click/Touch on Line ["+i+"]");var l=t.parents(".json-virtual-list-content");if(l&&l.length>0){var o=app.virtualList.get("#"+l[0].id);if(o){var s=o.items[i],p=app.view,u=t.closest(".virtual-list")||null,d=null;u&&(d=u[0].id),p&&p.length>0&&(app.emit("VirtualListLineClick",t,i,s,r),p[0].router.navigate("/"+r+"/?rowindex="+i+"&data="+encodeURIComponent(JSON.stringify(s))+"&key="+a+"&parentvlid="+d,{animate:!0,transition:n,reloadAll:!1}));var c=t.parents(".json-virtual-list")||null;c&&c.length>0&&(c=c[0]),app.emit("jsonRepeaterLineClick",c,i,a,s,r)}}}},getFlatFormData:function(e,t,i){for(var a in t){if("object"==typeof t[a]&&null!==t[a])if(Array.isArray(t[a]))i[a.replaceAll(" ","_")]=t[a];else jsonApiPlugin.getFlatFormData(e+"."+a,t[a],i);else i[e+"."+a.replaceAll(" ","_")]=t[a]}return i},setJsonFormData:function(e,t,i){if(t&&!0!==e.getAttribute("data-loaded")){var a={},r={};for(var n in t){if("object"==typeof t[n]&&null!==t[n])r=jsonApiPlugin.getFlatFormData(n,t[n],r);else r[n.replaceAll(" ","_")]=t[n]}thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Set JSON Form Data for form with ID ["+e.id+"]");for(let[e,t]of Object.entries(r)){var l=e;!0===["name","id","description","this","title","submit"].includes(l)&&(l+="_alias");var o=document.getElementsByName(l)[0];if(o){var s=o.classList.contains("shadow-text");if("checkbox"==o.type)"true"===t||!0===t||"1"===t||"on"===t?(a[l]="on",o.setAttribute("checked","checked")):(a[l]="off",o.removeAttribute("checked"));else if("select-one"==o.type||"select"==o.tagName.toLowerCase){$("#"+o.id).attr("data-value",t);var p=$("#"+o.id).closest(".smart-select");if(p&&p.length>0){var u=app.smartSelect.get(p);u&&u.setValue(t)}else{$("#"+o.id).val(t),0==$("#"+o.id).html().trim().length&&$("#"+o.id).html('<option value="'+t+'">'+t+"</option>")}a[e]=t}else if("image"==o.type)$("#"+o.id+"-fileinput-filename").css("visibility","hidden"),t&&t.length>0&&($("#"+o.id).css("background-image","url("+t+")"),$("#"+o.id+"-fileinput-filename span").text(t),$("#"+o.id+"-remove").show());else if("range"==o.type){a[e]=t;var d=app.range.get(o.parentElement);d?d.setValue(t):(d=app.range.create(o.parentElement)).setValue(t)}else if(1==s){a[e]=t;var c=o.id.replaceAll("-shadow",""),g=app.textEditor.get("#"+c);g&&g.setValue(t)}else if("text"==o.type)o.value=t;else if("textarea"==o.type)o.value=t;else if("radio"==o.type)for(var m=o.closest("ul"),h=o.getAttribute("name"),f=m.querySelectorAll("input[name='"+h+"']"),v=0;v<f.length;v++){var y=f[v];y.value==t?y.setAttribute("checked","checked"):y.removeAttribute("checked")}else if("file"==o.type){var A=o.getAttribute("data-fileinput-ref"),b=$("#"+A);if(b&&b.length>0){$("#"+A+"-fileinput-filename span");$("#"+A+"-fileinput-filename").show(),$("#"+A+"-fileinput-filename").css("visibility","visible"),$("#"+A+"-fileinput-filename span").text(t),$("#"+A+"-fileinput-filename i").show(),$("#"+A+"-fileinput-link").show(),$("#"+A+"-fileinput-link span").html('<a class="external" target="_blank" rel="noopener" data-rel="external" target="_blank" href="'+t+'">See attached file</a>'),t.length>0?$("#"+A+"-remove").show():$("#"+A+"-fileinput-filename").css("visibility","hidden")}a[e]=t}else a[e]=t,o.value=t}}app.form.fillFromData("#"+e.id,a),e.setAttribute("data-loaded",!0),e.setAttribute("data-parent-key",i)}},initAllJsonWidgets:function(e){var t,i,a,r,n=e.detail;if(n===page?r=app.root:(r=n.$el,t=n.route),r&&t){var l;if(!(i=t.query.data||null)&&jsonApiPlugin.dataset&&(i=jsonApiPlugin.dataset,t.query.data=i),t.query.rowindex||null,a=t.query.key||null,thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Get Page Parameters"),"undefined"==i&&(i=null),i)try{l=JSON.parse(i)}catch(e){var o="[com.thoriumbuilder.jsonapi] Get Page Parameters, Unable to Parse data parameter Json:"+e.message;return thoriumapi.logEvent(2,o),void app.dialog.alert(o)}jsonApiPlugin.currentKey=a,jsonApiPlugin.currentData=l,1==kShowPreloader&&app.preloader.show(),jsonApiPlugin.initAllDisplayers(a,l),jsonApiPlugin.initAllRepeaters(a),$(".form[data-from-repeater='true']").each((function(e){0==e.classList.contains("firebase-data-form")&&(app.emit("jsonFormInitialized",e,l,a),jsonApiPlugin.setJsonFormData(e,l,a),app.emit("formDataLoaded[#"+e.id+"]",e,l,a))}))}},initialize:function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.jsonapi] Initializing JSON API"),jsonApiPlugin.initAllRepeaters(null),jsonApiPlugin.initAllDisplayers(),thoriumCorePlugin.app.showAppLoader(!1)}};$(document).on("click",".item-json",(function(e){e.preventDefault();var t=e.target;t&&0==t.classList.contains("btn-json-page")&&jsonApiPlugin.repeaterLineClick(e,$(this))})),$(document).on("click",".json-field-link",(function(e){e.preventDefault();var t=this.querySelector(".json-field");if(t){t.style.whiteSpace="break-spaces";var i=t.innerText,a=document.querySelector(".text-viewer-popup .block-text");a&&(a.innerText=i),app.sheet.create({el:".text-viewer-popup",swipeToClose:!1,backdrop:!0,closeByBackdropClick:!0,closeByOutsideClick:!0,closeOnEscape:!0,animate:!0}).open(!0),t.style.whiteSpace="normal"}})),$(document).on("dblclick",".item-json",(function(e){e.preventDefault();var t=e.target;t&&0==t.classList.contains("btn-json-page")&&jsonApiPlugin.repeaterDblLineClick(e,$(this))})),$(document).on("click","a.collection-item-json",(function(e){e.preventDefault(),jsonApiPlugin.collectionrepeaterLineClick(e,$(this))})),$(document).on("click","a.btn-json-page",(function(e){e.preventDefault(),jsonApiPlugin.repeaterLineButtonClick(e,$(this))})),$(document).on("click","a.btn-json-filter",(function(e){e.preventDefault(),jsonApiPlugin.setRepeaterFilter(e,$(this))})),$(document).on("page:mounted",(function(e){e.preventDefault,jsonApiPlugin.initAllJsonWidgets(e)}));