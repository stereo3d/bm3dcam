/*!
 * Thorium Core functions for framework7 projects
 * Version 4.0 January, 2024
 * framework7 v8.x (https://framework7.io) MIT Licensed
 * Copyright 2018-2024 Thorium builder, All Rights Reserved.
 */
String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},String.prototype.escapeSpecialChars=function(){return this.replace(/[\\]/g,"\\\\").replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t").replace(/[\"]/g,'\\"').replace(/\\'/g,"\\'")};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,o,r,a,n,l,u="",c=0;for(e=Base64._utf8_encode(e);c<e.length;)r=(t=e.charCodeAt(c++))>>2,a=(3&t)<<4|(i=e.charCodeAt(c++))>>4,n=(15&i)<<2|(o=e.charCodeAt(c++))>>6,l=63&o,isNaN(i)?n=l=64:isNaN(o)&&(l=64),u=u+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(n)+this._keyStr.charAt(l);return u},decode:function(e){var t,i,o,r,a,n,l="",u=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");u<e.length;)t=this._keyStr.indexOf(e.charAt(u++))<<2|(r=this._keyStr.indexOf(e.charAt(u++)))>>4,i=(15&r)<<4|(a=this._keyStr.indexOf(e.charAt(u++)))>>2,o=(3&a)<<6|(n=this._keyStr.indexOf(e.charAt(u++))),l+=String.fromCharCode(t),64!=a&&(l+=String.fromCharCode(i)),64!=n&&(l+=String.fromCharCode(o));return l=Base64._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",i=0;i<e.length;i++){var o=e.charCodeAt(i);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t="",i=0,o=c1=c2=0;i<e.length;)(o=e.charCodeAt(i))<128?(t+=String.fromCharCode(o),i++):o>191&&o<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&o)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&o)<<12|(63&c2)<<6|63&c3),i+=3);return t}};function isDarkMode(){return document.documentElement.classList.contains("dark")?"1":"0"}var thoriumCorePlugin={name:"Thorium Builder Core Plugin",bundleid:"com.thoriumbuilder.core",version:"4.0.0",isLoading:!1,httpRoot:"",language:"en",direction:"ltr",currentPopover:null,currentBlob:null,emtyResultTemplate:'<p class="repeater-noresult">no results found</p>',app:{init:function(){document.addEventListener("deviceready",thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App Loaded")),thoriumCorePlugin.app.showAppLoader(!0),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Initializing App.."),1==kAutoUpdate&&thoriumCorePlugin.app.checkversion(),1==kMultilingual&&thoriumCorePlugin.translations.translate(),kOneSignalAppId.length>0&&thoriumCorePlugin.app.initializeServiceWorker(),0!=thoriumapi.isLocal()||0!=kDesktopAllowed||!app.device.desktop&&Framework7.support.touch&&(app.device.android||Framework7.device.ios)?(1==app.device.desktop&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App is running in Desktop mode"),1==Framework7.support.touch&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Touch support detected"),1==app.device.android&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Android Device detected"),1==app.device.ios&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] iOS Device detected"),1==app.device.cordova||1==app.device.capacitor?thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App is running in Native Hybrid mode"):1==app.device.webView&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App is installed to Home Screen"),1==kHybridAppsLog&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Debug Log is activated"),1==app.device.cordova||1==app.device.capacitor?(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App is running in Native Hybrid mode, set DB host to ["+kRemoteHost+"]"),thoriumCorePlugin.httpRoot=kRemoteHost):1==thoriumapi.isLocal()?(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App is running in Local mode, set DB host to ["+kLocalRoot+"]"),thoriumCorePlugin.httpRoot=kLocalRoot):(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App is running in PWA mode, set DB host to empty"),thoriumCorePlugin.httpRoot=""),1==kForceInstall&&0==app.device.webView&&"file:"!=window.location.protocol&&0==app.device.cordova&&(app.device.ios||app.device.android)&&thoriumCorePlugin.app.addToHomeScreen(),thoriumCorePlugin.app.setStyle(),thoriumCorePlugin.swiper.init(),thoriumCorePlugin.timepicker.init(),thoriumCorePlugin.calendars.init(),thoriumCorePlugin.texteditor.init(),thoriumCorePlugin.forms.init(),thoriumCorePlugin.initVirtualMediaLists(),thoriumCorePlugin.initAllAutoComplete(),thoriumCorePlugin.app.pullToRefreshHandle(null),thoriumCorePlugin.gauge.init(),1==app.device.cordova&&$(".webshare").hide(),setTimeout((function(){thoriumCorePlugin.effects.init()}),100),thoriumCorePlugin.app.initPlugins(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App initialized"),app.emit("appInitialised")):($("#page").hide(),thoriumCorePlugin.app.showAppLoader(!1),thoriumCorePlugin.showToast("This App can only run on a Mobile device",!1,"center",9999999))},initPlugins:function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Initializing Plugins"),"object"==typeof jsonApiPlugin&&jsonApiPlugin.initialize(),"object"==typeof openStreetMapPlugin&&openStreetMapPlugin.initialize(),"object"==typeof nodeQrcode&&nodeQrcode.initialize(),"object"==typeof chartJS&&chartJS.initialize(),"object"==typeof qrcodeReader&&qrcodeReader.initialize(),"object"==typeof googleMapPlugin&&googleMapPlugin.initialize(),"object"==typeof firebasePlugin&&firebasePlugin.initialize(),"object"==typeof firestorePlugin&&firestorePlugin.initialize(),"object"==typeof auth&&auth.initialize()},setStyle:function(){kCustomColor&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Apply Custom Color "+kCustomColor),document.documentElement.style.setProperty("--f7-theme-color",kCustomColor))},forceReload:function(e){var t=typeof caches;t&&"undefined"!=t?(!0===e&&app.dialog.progress("Updating App..."),caches.open("thorium-cache").then((function(e){e.delete("thorium-cache").then((function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Service Worker Cache Deleted ["+e+"]")}))})),"serviceWorker"in navigator&&"file:"!=window.location.protocol&&navigator.serviceWorker.controller&&(navigator.serviceWorker.getRegistrations().then((function(e){for(let t of e)t.unregister()})),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] service worker unregistred")),setTimeout((function(){try{const e=document.createElement("form");e.method="POST",e.action=location.href,document.body.appendChild(e),e.submit(),document.body.removeChild(e)}finally{app.dialog.close()}}),2e3)):thoriumapi.logEvent(1,"[com.thoriumbuilder.core] 'Caches' is onbly available with with https web sites")},checkversion:function(){var e=localStorage.getItem(app.id+".version");const t=Date.now();fetch("./version.json?dummy="+t,{method:"get",headers:{"Content-type":"application/json"}}).then((function(t){t.json().then((function(t){t&&t.version&&parseInt(t.version)!=parseInt(e)&&(localStorage.setItem(app.id+".version",t.version),thoriumCorePlugin.app.forceReload(!0))}))}))},initializeServiceWorker:function(){"serviceWorker"in navigator&&"file:"!=window.location.protocol?navigator.serviceWorker.controller?thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Thorium Service worker found"):navigator.serviceWorker.register("OneSignalSDKWorker.js",{scope:"./"}).then((function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Thorium Service worker registered for scope:"+e.scope)})).catch((function(e){thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+e.message+"] While loading oneSignal Service Worker"),app.dialog.alert(e.message)})):thoriumapi.logEvent(1,"[com.thoriumbuilder.core] No Service Worker Support on this Device");var e=window.OneSignal||[];e.push((function(){e.init({appId:kOneSignalAppId})})),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] One Signal Plugin Initialization with ID ["+kOneSignalAppId+"]")},pullToRefreshHandle:function(e){var t,i=$(".ptr-content");e&&(t=e.detail.route.query.key||null),i.on("ptr:refresh",(function(e){0==thoriumCorePlugin.isLoading&&(thoriumCorePlugin.isLoading=!0,thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Call to 'Pull to Refresh'"),setTimeout((function(){if(e.target.classList.contains("page-content")){var o=e.target.getAttribute("data-function");if(o&&o.length>0){var r=window[o];thoriumapi.callFunctionByName(r,null)}}var a=e.target.getAttribute("data-ptr-repeater");if(a){var n=document.getElementById(a);n&&n.classList.contains("firebase-virtual-list-content")&&(n.setAttribute("data-loaded","false"),"object"==typeof firestorePlugin&&firestorePlugin.firebase_initFirebaseVirtualLists(!1,t)),n&&n.classList.contains("json-virtual-list-content")&&(n.setAttribute("data-loaded","false"),"object"==typeof jsonApiPlugin&&jsonApiPlugin.initAllRepeaters(t,!0)),n&&n.classList.contains("dbexpress-virtual-list-content")&&(n.setAttribute("data-loaded","false"),"object"==typeof dbExpressData&&dbExpressData.initAllRepeaters(t))}i.removeClass("ptr-pull-up"),i.removeClass("ptr-transitioning"),i.removeClass("ptr-refreshing"),thoriumCorePlugin.isLoading=!1}),1e3))}))},addToHomeScreen:function(){if(!(0==kAddToHomeScreenIos&&1==app.device.ios||0==kAddToHomeScreenMd&&1==app.device.android)){var e;e=1==app.device.ios?(e=kAddToHomeScreenIosText).replaceAll("#ICON",'<i class="fa f7-icons">square_arrow_up</i>'):(e=kAddToHomeScreenMdText).replaceAll("#ICON",'<span class="fa material-icons">more_vert</span>');var t='<div class="sheet-modal addtohomescreen"><div class="sheet-modal-inner"><p class="ahs-title font-weight-bold">'+kAddToHomeScreenTitle+"</p><p>"+e+"</p>";1==kSkipButton&&(t=t+'<p><a class="link sheet-close">'+kSkipButtonText+"</a></p>"),t+='<p class="ios-only"><i class="fa f7-icons">chevron_down</i></p></div></div>',app.sheet.create({swipeToClose:!1,backdrop:!0,closeOnEscape:!1,closeByBackdropClick:!1,content:t}).open(!0)}},resize:function(){for(var e=document.querySelectorAll(".virtual-list"),t=0;t<e.length;t++){var i=e[t],o=app.virtualList.get(i);if(o){var r=o.params.height,a=i.querySelector("li");if(a){var n=a.offsetHeight||0;n>0&&n!=r&&(o.params.height=n,o.update())}}}},showAppLoader:function(e){var t=document.querySelector(".apploader");t&&(1==e?(t.style.display="block",app.preloader.showIn(t)):(t.style.display="none",app.preloader.hideIn(t)))}},swiper:{init:function(){for(var e=document.querySelectorAll(".swiper"),t=0;t<e.length;t++){var i=e[t],o=i.swiper;if(!o){const e=i.getAttribute("data-direction")||"horizontal",t=i.getAttribute("data-initial-slide")||0,r=i.getAttribute("data-loop")||!0,a="true"==i.getAttribute("data-swiper-dynamicbullets")||!1,n=i.getAttribute("data-effect")||"slide",l=i.getAttribute("data-swiper-type")||"bullets",u=i.getAttribute("data-slides-per-view")||1,c=i.getAttribute("data-space-between")||0,d="true"==i.getAttribute("data-draggable");o=new Swiper("#"+i.id,{effect:n,direction:e,initialSlide:t,slidesPerView:u,spaceBetween:c,autoHeight:!1,preloadImages:!0,loop:r,pagination:{el:".swiper-pagination",type:l,clickable:!0,dynamicBullets:a,dynamicMainBullets:5},draggable:d,simulateTouch:d})}}}},timepicker:{init:function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Initializing Time Picker");for(var e=document.querySelectorAll("input[data-date-type='time']"),t=0;t<e.length;t++)thoriumCorePlugin.timepicker.setup(e[t].id)},setup:function(e){if("true"!=document.getElementById(e).getAttribute("picker-initialized")){var t,i,o=app.picker.get("#"+e);if(!o)t=0==kHours12?[{values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{divider:!0,content:":"},{values:function(){for(var e=[],t=0;t<=59;t++)e.push(t<10?"0"+t:t);return e}()}]:[{values:function(){for(var e=[],t=0;t<=11;t++)e.push(t<10?"0"+t:t);return e}()},{divider:!0,content:":"},{values:function(){for(var e=[],t=0;t<=59;t++)e.push(t<10?"0"+t:t);return e}()},{divider:!0,content:" "},{values:(i=[],i.push("am"),i.push("pm"),i)}],o=app.picker.create({inputEl:"#"+e,rotateEffect:!1,sheetPush:!1,sheetSwipeToClose:!1,scrollToInput:!0,inputReadOnly:!0,backdrop:!0,closeByOutsideClick:!0,toolbar:!0,toolbarCloseText:"OK",cols:t,formatValue:function(e,t){return e[0]+":"+e[1]},on:{init:function(t){var i=document.getElementById(e).value,o=i.substr(0,i.indexOf(":")),r=i.substr(i.indexOf(":")+1,2),a=i.substr(i.indexOf(" ")+1,2);t.setValue([o,r,a],200)},change:function(t){if(""!=t.value[0]){var i,o=t.value[0]+":"+t.value[1];if(1==kHours12)if(o=o+" "+t.value[2],"am"==t.value[2])i="12"==t.value[0]?"00:"+t.value[1]:t.value[0]+":"+t.value[1];else{var r=parseInt(t.value[0])+12;24==r&&parseInt(t.value[1])>0&&(t.value[1]="00",o="12:00 pm"),r<10&&(r="0"+r),i=r+":"+t.value[1]}else i=t.value[0]+":"+t.value[1];t.setValue(o);var a=document.getElementById(e);a&&(a.setAttribute("type","text"),a.value=i,a.setAttribute("value",i))}}}}),document.getElementById(e).setAttribute("picker-initialized",!0)}}},calendars:{init:function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] initializing Calendars");for(var e=document.querySelectorAll("input[data-date-type]:not([data-date-type='time']"),t=0;t<e.length;t++){if(1!=("true"==(n=e[t]).getAttribute("calendar-initialized")||!1)){var i=n.getAttribute("data-date-type");thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Init Calendar Instance with ID ["+n.id+"]");var o="datetime-local"==i||!1,r="true"==n.getAttribute("data-date-min-today")||!1;thoriumCorePlugin.calendars.setup(n.id,o,r)}}var a=document.querySelectorAll(".custom-calendar-inline");for(t=0;t<a.length;t++){var n=a[t];thoriumCorePlugin.calendars.initInnerCalendar(n)}},setup:function(e,t,i){if("true"!=document.getElementById(e).getAttribute("calendar-initialized")){var o=app.calendar.get("#"+e);if(!o){var r;1==t?(r=kDateFormat,1==kHours12?r+=" hh::mm a":r+=" HH::mm"):r=kDateFormat;var a=null;1==i&&(a=new Date).setDate(a.getDate()-1),(o=app.calendar.create({inputEl:"#"+e,inputReadOnly:!0,timePicker:t,timePickerFormat:{hour:"numeric",minute:"numeric"},touchMove:!1,animate:!0,backdrop:!0,closeOnSelect:!0,weekHeader:!0,monthSelector:!0,monthPicker:!0,yearSelector:!0,dateFormat:r,minDate:a,on:{change:function(e,t){if(t&&"0"!=t){var i=new Date(t);i.getFullYear(),i.getMonth(),i.getDate();e.inputEl.value=i.toLocaleString();var o=6e4*i.getTimezoneOffset();i.setTime(i.getTime()-o);var r=i.getTime()/1e3;e.inputEl.setAttribute("data-timestamp",r)}else e.inputEl.setAttribute("data-timestamp","")},open:function(e){var t=e.inputEl.getAttribute("data-timestamp")||null;if(t&&t.length>0){var i=new Date(1e3*t);e.currentYear=i.getFullYear(),e.currentMonth=i.getMonth(),e.setValue([i]);var o=document.querySelector(".calendar .current-year-value");o&&(o.textContent=i.getFullYear())}e.update()}}})).dayNames=kdayNames,o.dayNamesShort=kdayNamesShort,o.monthNames=kmonthNames,o.monthNamesShort=kmonthNamesShort,document.getElementById(e).setAttribute("calendar-initialized","true")}}},initInnerCalendar:function(e){if("true"!=e.getAttribute("data-initialized")){var t=null,i=new Date,o=new Date;o.setDate(i.getDate()-1),(new Date).setDate(i.getDate()+1);var r=null;1==("true"==e.getAttribute("data-date-min-today"))&&(r=o);var a="true"==e.getAttribute("data-date-multiple"),n="true"==e.getAttribute("data-date-touchmove"),l="true"==e.getAttribute("data-date-weekheader"),u="true"==e.getAttribute("data-date-monthselector"),c="true"==e.getAttribute("data-date-yearselector"),d=!1;1!=u&&1!=c||(d=!0);var p=e.getAttribute("data-date-locale")||"en-US",s="true"==e.getAttribute("data-date-timeselector"),m=e.getAttribute("data-date-timeselector-text")||"Select Time";if("true"==e.getAttribute("data-initialized")){var g=e.querySelector(".calendar");g&&(t=app.calendar.get(g))&&(e.innerHTML="",app.calendar.destroy(t))}t=app.calendar.create({containerEl:e,locale:p,dayNames:kdayNames,dayNamesShort:kdayNamesShort,monthNames:kmonthNames,monthNamesShort:kmonthNamesShort,value:null,disabled:null,events:null,multiple:a,rangePicker:!1,rangePickerMinDays:null,rangePickerMaxDays:null,direction:"horizontal",minDate:r,maxDate:null,touchMove:n,animate:!0,weekHeader:l,monthSelector:u,monthPicker:!1,yearSelector:c,yearPicker:!1,yearPickerMin:null,yearPickerMax:null,timePicker:s,timePickerFormat:{hour:"numeric",minute:"numeric"},timePickerPlaceholder:m,toolbar:d,toolbarCloseText:"Close",header:!1,headerPlaceholder:"Select date",on:{init:function(t){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Initializing Calendar Widget"),app.emit("calendarInit",t),e.setAttribute("data-initialized","true")},dayClick:function(e,t,i,o,r){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calendar Widget DayClick"),app.emit("customcalendarDayClick",e,t,i,o,r)},change:function(t,i){if(1==e.classList.contains("custom-db-calendar")){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calendar Widget Change");var o={};if(t.params.events&&i)for(var r=0;r<t.params.events.length;r++){if(t.params.events[r].date.toString()==i[0].toString()){o=t.params.events[r].custom;break}}var a=new Date([i[i.length-1]]);if(a){var n=a.getTime()/1e3;e.setAttribute("data-timestamp",n);var l=t.$containerEl[0].closest(".custom-db-calendar");if(l){var u=l.getAttribute("data-target")||null,c=o.uid,d=o.dataindex,p=o.pk,s=app.view,m=l.getAttribute("data-service")||null;if(s&&s.length>0&&u&&u.length>0&&m&&m.length>0&&o&&c){var g="/"+u+"/?rowindex="+d+"&uid="+c+"&pk="+p+"&service="+m,h={};h.rowindex=d,h.uid=c,h.pk=p,h.service=m,thoriumapi.loadpage(g,h,null)}}}app.emit('dbItemChange[id="'+e.id+'"]',t,i,o)}},monthAdd:function(e,t){app.emit("calendarMonthAdd",e,t)},monthYearChangeStart:function(e,t,i){app.emit("calendarMonthYearChangeStart",t,i)},open:function(t){app.emit("calendarOpen",t),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Opening Calendar Widget");var i=e.getAttribute("data-timestamp")||null;if(i){var o=new Date(1e3*i);t.currentYear=o.getFullYear(),t.currentMonth=o.getMonth()}},opened:function(e){app.emit("calendarOpened",e),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calendar Widget Opened")},close:function(e){app.emit("calendarClose",e),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Closing Calendar Widget")},closed:function(e){app.emit("calendarClosed",e),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calendar Widget Closed")},beforeDestroy:function(e){app.emit("calendarBeforeDestroy",e),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Destroying Calendar Widget")}}})}}},texteditor:{init:function(){for(var e=document.querySelectorAll(".text-editor"),t=0;t<e.length;t++){var i=e[t];thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Init Text Editor Instance with ID ["+i.id+"]");var o=app.textEditor.get("#"+i.id);o||(o=thoriumCorePlugin.texteditor.setup(i))}},setup:function(e){return e.setAttribute("texteditor-initialized",!0),app.textEditor.create({el:"#"+e.id,buttons:kTextEditorButtons,on:{change:function(e){var t=e.el.id+"-shadow",i=e.value||"";i=i.replaceAll("<p></p>","").trim();var o=document.getElementById(t);o&&(o.value=i)},init:function(e){var t=e.el.id+"-shadow",i=e.value||"";i=i.replaceAll("<p></p>","").trim();var o=document.getElementById(t);o&&(o.value=i)}}})}},photobrowser:{getnavbar:function(){return'<div class="navbar navbar-photo-browser">                     <div class="navbar-bg"></div>                     <div class="navbar-inner navbar-inner-centered-title">                       <div class="left">                         <a class="link webshare" data-webshare-textref="" data-webshare-imgref=".swiper-slide-active .swiper-zoom-container img" >                             <i class="fa material-icons">share</i>                         </a>                       </div>                       <div class="title">                         <span class="photo-browser-current"></span>                         <span class="photo-browser-of">/</span>                         <span class="photo-browser-total"></span>                       </div>                       <div class="right">                         <a class="link popup-close" data-popup=".photo-browser-popup">                           <span>'+kPhotoBrowserBackLinkText+"</span>                         </a>                       </div>                     </div>                   </div>"},show:function(e,t){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Photo Browser"),t=t||0;var i=e.length>1,o=null;1==kWebShareApi&&(o=thoriumCorePlugin.photobrowser.getnavbar);var r=app.photoBrowser.create({swipeToClose:!0,photos:e,thumbs:e,exposition:!0,expositionHideCaptions:!1,backLinkText:kPhotoBrowserBackLinkText,navbarOfText:"/",theme:kPhotoBrowserTheme,captionsTheme:kPhotoBrowserTheme,navbar:!0,toolbar:i,type:"standalone",lazyLoading:!0,captionTemplate:"title",navbarTemplate:"title",renderNavbar:o,swiper:{effect:kPhotoBrowserEffect,kPhotoBrowserAutoPlay:kPhotoBrowserAutoPlay,grabCursor:!0,spaceBetween:20,speed:300,loop:!1,preuploadFileReads:!1,zoom:{enabled:!0,maxRatio:3,minRatio:1},lazy:{enabled:!1}}});r.open(t),app.emit("photobrowserDisplayed",r)},showImageZoom:function(e){e.preventDefault,thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Photo Browser");var t=e.target;if(t){var i=[],o=t.getAttribute("src"),r=t.getAttribute("title");if(!o){if((o=t.style.backgroundImage).indexOf(",")>-1){var a=o.substring(0,o.indexOf(","));o=a}")"==(o=(o=o.replace("url(","")).replace(/\"/gi,"")).substr(o.length-1)&&(o=o.substr(0,o.length-1))}var n={};n.url=o,n.caption=r,i.push(n),thoriumCorePlugin.photobrowser.show(i,0)}},showMedialistZoom:function(e,t){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Medialist Photo Browser");var i=e.closest(".virtual-list");if(i){var o=app.virtualList.get(i);if(o){for(var r=[],a=e.getAttribute("data-index")||0,n=0;n<o.items.length;n++){var l={};l.url=o.items[n].imagesrc,l.caption=o.items[n].title,r.push(l)}thoriumCorePlugin.photobrowser.show(r,parseInt(a))}else thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Medialist Item Parent VL not found")}else thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Medialist Item Parent VL not found")},showCollectionZoom:function(e,t){var i;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Collection Photo Browser");var o=[],r=0,a=e.querySelector(".collection-item-image");a&&(i=a.getAttribute("data-file"));var n=e.closest(".collection");if(n)for(var l=n.querySelectorAll(".collection-item:not(.templaterow)"),u=0;u<l.length;u++){var c=l[u].querySelector(".collection-item-image");if(c){var d={},p=c.getAttribute("data-file");d.url=p,d.caption=c.getAttribute("title"),o.push(d),p==i&&(r=u)}}thoriumCorePlugin.photobrowser.show(o,r)}},effects:{init:function(){for(var e=document.querySelectorAll("* [data-transform-trigger='pageload']"),t=0;t<e.length;t++){var i=e[t];thoriumCorePlugin.effects.execute(i)}},execute:function(e){if("false"==(e.getAttribute("data-effect-loaded")||"false")){var t=e.getAttribute("data-transform-effect")||"";e.style.transform=t;var i=e.getAttribute("data-transform-opacity")||"";e.style.opacity=i,thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Apply Effect to element "+e.id+" ["+t+"]"),e.setAttribute("data-effect-loaded","true")}},reset:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Remove Effect from element "+e.id);var t=e.getAttribute("data-stored-state")||"";e.style.transform=t;var i=e.getAttribute("data-initial-opacity")||"";e.style.opacity=i},scrolleffect:function(e){for(var t=document.querySelectorAll("* [data-transform-trigger='viewport']:not(.activeeffect)"),i=0;i<t.length;i++){var o=t[i];if(thoriumCorePlugin.getObjectViewPortPercent(o,e.scrollTop)>(o.getAttribute("data-transform-viewport")||0)){o.classList.add("activeeffect");var r=o.getAttribute("data-transform-effect")||"";o.style.transform=r;var a=o.getAttribute("data-transform-opacity")||"";o.style.opacity=a}}}},translations:{recursive:function(e,t){if(0==e.childElementCount){var i=e.getAttribute(t);e.innerText=i,e.childNodes[0].nodeValue=i}else{for(var o=e.querySelectorAll("* ["+t+"]"),r=0;r<o.length;r++){var a=o[r];thoriumCorePlugin.translations.recursive(a,t)}(i=e.getAttribute(t)||null)&&(i.indexOf("<")>-1?e.innerHTML=i:e.innerText=i)}},translate:function(e,t){var i=document.documentElement.lang||"en";document.documentElement.dir;e||(e=sessionStorage.getItem("thorium.language")||i),t||"undefined"==(t=sessionStorage.getItem("thorium.direction"))&&(t=thoriumCorePlugin.direction),"undefined"==e&&(e=i),t=t||"ltr",document.documentElement.dir=t,thoriumCorePlugin.language=e,thoriumCorePlugin.direction=t,sessionStorage.setItem("thorium.language",e),sessionStorage.setItem("thorium.direction",t),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Translate Screen to "+e),thoriumCorePlugin.multilingual=!0;for(var o="data-translate-"+e,r=document.querySelectorAll("* ["+o+"]"),a=0;a<r.length;a++){var n=r[a];thoriumCorePlugin.translations.recursive(n,o)}o="placeholder-"+e;for(r=document.querySelectorAll("* ["+o+"]"),a=0;a<r.length;a++){var l=(n=r[a]).getAttribute(o);n.setAttribute("placeholder",l)}}},geolocation:{locate:function(e){if(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Trying to geolocate user..."),navigator.geolocation)try{navigator.geolocation.getCurrentPosition((function(t){e.value.includes("{")||(e.value="{"+t.coords.latitude+","+t.coords.longitude+"}",$("#"+e.id).data("pos",t),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] User Geolocated "+t.coords.latitude+","+t.coords.longitude),e.classList.remove("disabled"))}),(function(t){thoriumapi.logEvent(1,"[com.thoriumbuilder.core] "+t.message),e.value.includes("{")||(e.value=t.message,e.classList.add("disabled"))}))}catch(e){thoriumapi.logEvent(1,"[com.thoriumbuilder.core] "+e.message),app.dialog.alert(e.message)}else thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Geolocation is not supported."),e.value.includes("{")||(e.value="Geolocation is not supported.")}},forms:{init:function(e){e=e||null;for(var t=document.querySelectorAll(".form-ajax-submit"),i=0;i<t.length;i++){var o=t[i];if("true"!=(o.getAttribute("data-loaded")||"false")&&"shoppingcartform"!=o.id&&"form-orderprocess"!=o.id&&"dbexpress-signin-form"!=o.id&&"resetpw-form"!=o.id&&"register-form"!=o.id&&"dbexpress-profile-form"!=o.id){if(e){var r=e.detail;if(r){var a=r.route.query.key||null;a&&o.setAttribute("data-parent-key",a)}}thoriumCorePlugin.forms.setup(o)}}},setup:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Initializing Form with id ["+e.id+"]");for(var t=e.querySelectorAll("input[data-autofill='true']"),i=0;i<t.length;i++){var o=(n=t[i]).getAttribute("type"),r=n.getAttribute("data-date-type")||null;if(!(l=n.value)||0==l.length){if("date"==o&&(n.value=thoriumCorePlugin.ISO8601(new Date)),"time"==o&&(n.value=thoriumCorePlugin.getTime(new Date)),"datetime-local"==o&&(n.value=thoriumCorePlugin.ISO8601(new Date)+" "+thoriumCorePlugin.getTime(new Date)),"geo"==o&&thoriumCorePlugin.geolocation.locate(n),"datetime-local"==r||"date"==r){l=thoriumapi.date.getTimeStamp(),n.setAttribute("data-timestamp",l);var a=thoriumapi.date.getDateTimeFromTimeStamp(l,r);n.setAttribute("value",a),n.value=a}thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Input ["+n.name+"] with attribute AutoFill initialized with value ["+n.value+"]")}}for(t=e.querySelectorAll("input"),i=0;i<t.length;i++){var n,l;if((l=(n=t[i]).value)&&l.length>0)for(var u,c=l,d=/[^{\}]+(?=})/g;u=d.exec(c);){var p="",s=u[0];try{p=window[s],n.value=p||""}catch(e){thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Unable to find variable "+s+"]")}}}if($("#"+e.id+" select[data-api-mode]").each((function(e){var t=e.getAttribute("data-api")||null,i=e.getAttribute("data-api-field")||null,o=e.getAttribute("data-select-collection")||null,r=e.getAttribute("data-api-fieldid")||null,a=e.getAttribute("data-function")||null,n=0;n=e.getAttribute("data-api-mode")||"0",t&&"0"==n&&(n=1),"1"==n&&t&&i?(thoriumCorePlugin.forms.fillSelect(e,t,i,n,r,a),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Input ["+e.name+"] of type Select initialized from api ["+t+"]")):"2"==n&&o&&i&&(setTimeout((function(){thoriumCorePlugin.forms.fillSelect(e,o,i,n,r,a)}),100),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Input ["+e.name+"] of type Select initialized from api ["+t+"]"))})),"object"==typeof dbExpressData)for(t=document.querySelectorAll("#"+e.id+" select[data-service]"),i=0;i<t.length;i++){var m=t[i],g=m.getAttribute("data-service")||null,h=document.querySelector(".page-current");if(h){var f=h.getAttribute("data-record-service")||null,v=h.getAttribute("data-record-pk")||null;f&&v&&g==f&&m.setAttribute("data-value",v)}var b=e.getAttribute("data-init-mode")||0;g&&1!=b&&dbExpressData.fillSmartSelect(m,g)}},fillSelect:function(e,t,i,o,r,a){if("true"!=e.getAttribute("data-loaded"))if($("#"+e.id).addClass("disabled"),app.preloader.show(),"2"==o)"object"==typeof firestorePlugin&&firestorePlugin.initFormSelectWithCollection(e,t,i);else{var n={},l={},u=!1;if(n.method="GET",kMode.length>0&&(n.mode=kMode),kCache.length>0&&(n.cache=kCache),kCredentials.length>0&&(n.credentials=kCredentials),kContenttype.length>0&&(l["Content-Type"]=kContenttype,u=!0),kRedirect.length>0&&(l.redirect=kRedirect,u=!0),kReferrerpolicy.length>0&&(l.referrerpolicy=kReferrerpolicy,u=!0),kAuthorization.length>0&&(l.Authorization=kAuthorization,u=!0),1==u&&(n.headers=l),a){var c=window[a],d=[n];"function"==typeof c&&(n=c.apply(this,d))}var p=e.closest(".form");if(p){var s=p.getAttribute("data-parent-key")||"";t=t.replace("{key}",encodeURIComponent(s))}for(var m,g=t,h=/[^{\}]+(?=})/g;m=h.exec(g);){var f=m[0];if(f&&f.length>0){var v="";try{v=window[f]}catch(e){app.preloader.hide();var b="[com.thoriumbuilder.core] Unable to find variable "+f+"] "+e;return void app.dialog.alert(b)}if(!v){app.preloader.hide();b="[com.thoriumbuilder.core] variable ["+f+"] is undefined";return void app.dialog.alert(b)}t=t.replace("{"+f+"}",encodeURIComponent(v))}}thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calling Api  ["+t+"]"),fetch(t,n).then((function(o){o.json().then((o=>{thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Api received Response from url ["+t+"]"),app.emit("dataloadSuccess",e);var a='<option value="" disabled></option>';for(var n in r=r||i,o)a=a+'<option value="'+o[n][r]+'">'+o[n][i]+"</option>";e.innerHTML=a;var l=e.getAttribute("data-value")||"";if(l.length>0){var u=$(e).closest(".smart-select");if(u){var c=app.smartSelect.get(u);c&&c.setValue(l)}else e.value=l}$("#"+e.id).removeClass("disabled"),e.setAttribute("data-loaded","true"),setTimeout((function(){app.preloader.hide()}),1e3)})).catch((function(e){app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+e.message+"] While loading data from ["+t+"]"),app.dialog.alert(e.message)}))})).catch((function(e){app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+e.message+"]"),0==app.online?thoriumapi.showNotification("Internet connection lost"):app.dialog.alert(e.message)}))}},getformdata:function(e,t){for(var i=new FormData,o=0;o<e.length;o++){var r="_alias",a=["name"+r,"id"+r,"description"+r,"this"+r,"title"+r,"submit"+r],n=e[o].name,l=n;!0===a.includes(l)&&(l=l.replaceAll(r,""));var u,c=e[o].type,d=!1;if("text"==c?(u=e.querySelector("input[name="+n+"]").getAttribute("data-date-type"),d="geo"==e.querySelector("input[name="+n+"]").getAttribute("type")):u="","radio"==c)!0===e[o].checked&&i.append(l,e[o].value);else if("geo"==c||1==d){if((f=e[o].value)&&f.length>0){const e=(f=f.replaceAll("{","").replaceAll("}","")).split(",");if(e&&2==e.length){const t="{"+e[0]+","+e[1]+"}";i.append(l,t)}else i.append(l,"")}else i.append(l,"")}else if("checkbox"==c)i.append(l,e[o].checked);else if("submit"==c||"button"==c);else if("file"==c){var p=e[o].id;if(m=$("#"+p))if(g=m.data("data-blob"))-1==l.indexOf("-fileinput")&&(l+="-fileinput"),i.append(l,g);else if(0==t){var s=e[o].files[0];s?i.append("file",s):thoriumapi.logEvent(1,"[com.thoriumbuilder.core] empty file for field "+n+" for Form with ID ["+e.id+"]")}else{var m,g;if(m=$("#"+p))(g=m.data("data-blob"))||(g=""),i.append(l,g)}}else if("datetime-local"==u||"date"==u){var h=e[o].getAttribute("data-timestamp")||null;h?i.append(l,h):i.append(l,"0")}else{var f;0==(f=e[o].value).length&&(f="number"==c?"0":"null"),i.append(l,f)}}return i},setOptionsHeaders:function(e,t,i){const o=Object.fromEntries(i.entries()),r=JSON.stringify(o);var a=e.getAttribute("data-api-method")||"post",n=e.getAttribute("data-api_referrer")||"",l=e.getAttribute("data-api-referrerpolicy")||"",u=e.getAttribute("data-api-mode")||"",c=e.getAttribute("data-api-cache")||"",d=e.getAttribute("data-api-credentials")||"",p=e.getAttribute("data-api-redirect")||"",s=(e.getAttribute("data-api-contenttype"),e.getAttribute("data-api-accept")||"application/json"),m=e.getAttribute("data-api-authorization")||"";m.length>0&&(m=thoriumapi.replaceDynamicVariables(m));var g=e.getAttribute("data-api-header_key")||"",h=e.getAttribute("data-api-header_value")||"",f={},v={};if(f.method=a,n.length>0&&(f.referrer=n),l.length>0&&(f.referrerpolicy=l),u.length>0&&(f.mode=u),c.length>0&&(f.cache=c),d.length>0&&(f.credentials=d),p.length>0&&(f.redirect=p),m.length>0&&(v.Authorization=thoriumapi.replaceDynamicVariables(m)),g.length>0&&h.length>0&&(v[g]=h),s.length>0&&(v.accept=s),0==t)f.body=i;else{var b;0==s.length&&(v.accept="application/json");var w=e.getAttribute("data-api-root")||"";b=w&&w.length>0?'{"'+w+'": ['+r+"]}":r,f.body=b,v["Content-Type"]="application/json"}return f.headers=v,f},beforeSubmitFunction:function(e,t){var i=e.getAttribute("data-form-beforesubmit");if(i){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Function ["+i+"] Called for Form with id ["+e.id+"]");var o=window[i],r=[e,t],a=thoriumapi.callFunctionByName(o,r);if(0==a){var n='[com.thoriumbuilder.core] An error occured "'+i+'" is not an existing function';return void thoriumapi.logEvent(2,n)}t=a[1]}return t},afterSubmitFunction:function(e,t){var i=e.getAttribute("data-return-function")||null;if(i){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form with id ["+e.id+"] : Calling JS function ["+i+"]");var o=window[i],r=[e,t];if("function"==typeof o){o.apply(this,r);app.preloader.hide(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] JS function ["+i+"] called successfully when submitting Form with id ["+e.id+"]")}else{app.preloader.hide();var a='An error occured "'+i+'" is not an existing function';thoriumapi.logEvent(2,"[com.thoriumbuilder.core] JS function ["+i+"] called with Error: ["+a+"] when submitting Form with id ["+e.id+"]"),app.dialog.alert(a),app.emit("userFormError",a,e)}}},submitForm:function(e,t){e.preventDefault;var i="";if(0!=app.input.validateInputs(t)){var o=t.getAttribute("data-api-data-mode")||0;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Formating Data for Form with id ["+t.id+"]");var r=thoriumCorePlugin.forms.getformdata(t,o),a=thoriumCorePlugin.forms.setOptionsHeaders(t,o,r);a=thoriumCorePlugin.forms.beforeSubmitFunction(t,a),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Submiting Form with id ["+t.id+"]");var n=t.getAttribute("data-mode")||null,l=t.getAttribute("data-form-message");if(0==n){if(!(t.getAttribute("data-email")||null)){var u="Recipient email not set for the form";return thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error: ["+u+"] when submitting Form with id ["+t.id+"]"),app.dialog.alert(u),void app.emit("userFormError",u,t,0,null)}if(1==thoriumapi.isLocal()&&0==n)return l.length>0&&(app.preloader.hide(),app.dialog.alert(l)),thoriumapi.logEvent(1,"[com.thoriumbuilder.core] This Form can't send an email when running from the simulator"),void thoriumapi.showNotification("This Form can't send an email when running from the simulator");i=thoriumCorePlugin.httpRoot+"forms/form.php"}else{if(2==n){var c=t.getAttribute("data-form-function");if(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calling Function ["+c+"] for Form with id ["+t.id+"]"),c){var d,p=window[c];if(o=0)d=[t,r];else{const e=Object.fromEntries(r.entries()),i=JSON.stringify(e);d=[t,i]}0==thoriumapi.callFunctionByName(p,d)&&l.length>0&&app.dialog.alert(l)}return}if(1==n){if(!(i=t.getAttribute("data-api-url"))){u="form url not defined!";return thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error: ["+u+"] when submitting Form with id ["+t.id+"]"),app.dialog.alert(u),void app.emit("userFormError",u,t,0,null)}var s=t.getAttribute("data-parent-key")||null;s&&(i=i.replaceAll("{key}",s))}}app.preloader.show(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Sending Data to: ["+i+"] from Form with id ["+t.id+"]"),fetch(i,a).then(thoriumapi.status).then(thoriumapi.json).then((function(i){app.preloader.hide(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form with id ["+t.id+"] Sent with Success"),l.length>0&&app.dialog.alert(l),app.emit("userFormSuccess",i,t),"true"==(t.getAttribute("data-reset-form")||"false")&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Reset"),e.target.reset(),$("#"+e.target.id+" .text-editor").each((function(e){var t=app.textEditor.get("#"+e.id);t&&t.setValue("")})),$(".firebase_document_preview").css("background-image",""),$(".input-filename span").html(""),$(".firebase_fileupload-rotate").hide(),$(".firebase_fileupload-remove").hide(),$(".input-filename i").hide()),a=thoriumCorePlugin.forms.afterSubmitFunction(t,i);var o=t.getAttribute("data-form-postprocess")||0;0==o?thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Sent"):1==o?(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Going Back to Previous Page"),thoriumapi.backToPreviousPage()):2==o&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Reloading Home Page"),thoriumapi.reloadHomePage())})).catch((function(e){thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Request failed "+e),app.preloader.hide(),app.dialog.close();var i=t.getAttribute("data-form-error-message")||"",o=e.message;thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Form Error: ["+e.message+"] when submitting Form with id ["+t.id+"]"),i.length>0?app.dialog.alert(i):app.dialog.alert("An error occured ["+o+"] when submitting Form with id ["+t.id+"]"),app.emit("userFormError",o,t)}))}else thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Missing Mandatory fields for Form with id ["+t.id+"]")}},virtuallist:{getVlTemplateHeight:function(e,t){var i,o=e.querySelector(".virtuallist-template");if(!(i=o?o.innerHTML:$("#"+e.id).data("template"))||0==i.length)return thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Unable to get Template for Repeater with id ["+e.id+"]"),void app.preloader.hide();var r=e.offsetWidth;i=i.replace("url({{productimage}})","url('./img/defaultimg.png')");var a=document.createElement("div");r>0&&(a.style.width=r+"px");var n=e.classList.value;a.innerHTML=t>1?'<div class="'+n+' row no-gap multicol w-100 temptemplate">'+i+"</div>":'<div class="'+n+' w-100 temptemplate"><ul>'+i+"</ul></div>",document.getElementById("app").appendChild(a);var l=a.offsetHeight;l&&-5!=l||(l=0),a.remove(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calculating Template Line Height ("+t+" columns) for Repeater with ID: ["+e.id+"] => ["+l+"px]");var u="tmp-"+e.id,c=document.getElementById(u);return c&&c.parentNode&&c.parentNode.removeChild(c),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Template Line Height ("+t+" columns) Applied for Repeater with ID: ["+e.id+"] => ["+l+"px]"),l||0},applyFormulaToField(e,t,o,r){if(e.classList.contains("hideifempty")&&(0==r.length||"0"==r))return e.classList.add("hidden"),t=t.replaceAll(e.innerHTML,"");var a=e.getAttribute("data-function"),n=e.getAttribute("data-date-type")||null,l=e.getAttribute("data-dbexpress-type")||null;if(a&&"boolean"==a){var u=e.getAttribute("data-icon-false")||"",c=e.getAttribute("data-icon-true")||"",d=e.getAttribute("data-color-false")||"",p=e.getAttribute("data-color-true")||"",s=e.getAttribute("data-icon-size")||"16",m="";if(c.length>0)if(0==c.indexOf("md_"))m='<i class="'+p+' fa material-icons" style="font-size:'+s+'px;" >'+c.replace("md_","")+"</i>";else m='<i class="'+p+' f7-icons" style="font-size:'+s+'px;" >'+c+"</i>";var g="";if(u.length>0)if(0==u.indexOf("md_"))g='<i class="'+p+' fa material-icons" style="font-size:'+s+'px;" >'+u.replace("md_","")+"</i>";else g='<i class="'+d+' f7-icons" style="font-size:'+s+'px;" >'+u+"</i>";(u.length>0||c.length>0)&&(t="1"==r?t.replaceAll("{{"+o+"}}",m):t.replaceAll("{{"+o+"}}",g))}else if(a&&"value"==a){d=e.getAttribute("data-color-false")||"",p=e.getAttribute("data-color-true")||"";d&&p&&(t=r>=0?t.replaceAll("{{datacolorclass}}",p):t.replaceAll("{{datacolorclass}}",d))}if("time"==l)if(parseInt(r)==r)if("0"==r)t=t.replaceAll("{{"+o+"}}","");else{var h=Math.floor(parseInt(r)/60),f=parseInt(r)/60,v=parseInt(60*(parseFloat(f)-h));h<10&&(h="0"+h),v<10&&(v="0"+v),t=t.replaceAll("{{"+o+"}}",h+":"+v)}else t=t.replaceAll("{{"+o+"}}",r);else if(n&&r&&r.toString().length>0&&0!=r&&("datetime-local"==n||"date"==n)){var b="",w=!1;l&&("datetime"!=l&&"time"!=l||(w=!0)),r&&"0"!=r&&r.toString().length>0?(b=thoriumapi.date.getDateTimeFromTimeStamp(r,n,"",w),t=t.replaceAll("{{"+o+"}}",b)):t=t.replaceAll("{{"+o+"}}","")}else if(r||"datetime-local"!=n&&"date"!=n)if(!r||0!=r||"datetime-local"!=n&&"date"!=n){if(l&&"decimal"==l){r||(r=0);var y=e.getAttribute("data-decimals")||2,A=parseFloat(r).toFixed(y);Math.trunc(r),t=t.replaceAll("{{"+o+"}}",A)}else if(l&&"rating"==l){r||(r=0);var k='<i class="fa f7-icons s-3">'+kRatingIcon+"</i>",C=parseInt(r)||0,E="";for(i=0;i<C;i++)E+=k;t=t.replaceAll("{{"+o+"}}",E)}else if(l&&"picture"==l&&r&&r.length>0){var S=Math.floor(Date.now()/1e3);t=t.replaceAll("{{"+o+"}}",r+"?rnd="+S)}}else t=t.replaceAll("{{"+o+"}}","");else t=t.replaceAll("{{"+o+"}}","");return t},renderVlItem:function(e,t,i,o){var r=i.closest(".virtual-list");for(const[o,c]of Object.entries(e)){var a=c;"null"!=a&&null!=a||(a=""),a&&a.length>0&&0==kDbHTMLRendering&&(a=a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")),"auth_photourl"==o&&0==a.length&&t.indexOf("{{auth_photourl}}")>=0&&(t=t.replace("url(db/dbassets/{{auth_photourl}})","url('./img/defaultavatar.png')"));var n="./img/defaultimg.png";if(r){var l=r.getAttribute("data-alternate-img")||null;l&&l.length>0&&(n="./img/"+l)}if(t=(t=(t=(t=t.replace("url('"+kRemoteHost+"db/dbassets/')","url('"+n+"')")).replace("url("+kRemoteHost+"db/dbassets/)","url("+n+")")).replace("url('db/dbassets/')","url('"+n+"')")).replace("url(db/dbassets/)","url("+n+")"),i){var u=i.querySelector('*[data-dbexpress-field="'+o+'"]');u&&(t=thoriumCorePlugin.virtuallist.applyFormulaToField(u,t,o,a))}t=(t=(t=(t=t.replaceAll("{{"+o+"}}",a)).replaceAll("{"+o+"}",a)).replaceAll("{{}}","")).replaceAll("{}","")}t=t.replace(/>{{.*}}</,">&nbsp;<");var c=new RegExp("({{[\\d\\D]*?}})","g");return t=t.replace(c,"'img/defaultimg.png'")},renderVirtualListFromData:function(e,t,i){var o=1;o=window.innerWidth>=768?e.getAttribute("data-col-count-tablet")||1:e.getAttribute("data-col-count")||1,t||thoriumapi.logEvent(1,"[com.thoriumbuilder.core] renderVirtualListFromData initialized with null items");var r=t.length||0;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Rendering Repeater Virtual List ["+r+" rows]");var a=thoriumCorePlugin.virtuallist.getVlTemplateHeight(e,o);(d=app.virtualList.get(e))&&app.virtualList.destroy(d),t.length||(t.length=0);var n=e.querySelector(".templaterow");n||((n=document.createElement("div")).innerHTML=i,document.getElementById("app").appendChild(n));var l=document.documentElement.lang||"en",u=sessionStorage.getItem("thorium.language")||l,c=e.getAttribute("data-noresult-"+u)||null;c&&0!=c.length||(c=e.getAttribute("data-noresult")||"no results found"),thoriumCorePlugin.emtyResultTemplate='<p class="repeater-noresult">'+c+"</p>",d=app.virtualList.create({el:e,items:t,createUl:!0,cols:o,setListHeight:!0,height:a,emptyTemplate:thoriumCorePlugin.emtyResultTemplate,searchAll:function(e,t){for(var i=[],o=0;o<t.length;o++){(JSON.stringify(t[o]).toLowerCase().indexOf(e.toLowerCase())>=0||""===e.trim())&&i.push(o)}return i},renderItem:e=>thoriumCorePlugin.virtuallist.renderVlItem(e,i,n,a),on:{itemsAfterInsert:function(e,t){"object"==typeof dbExpressData&&e&&e.el&&dbExpressData.applyUserRolePermissions(e.el)}}});var d,p=d.$el[0];if(p&&(p.setAttribute("data-loaded",!0),p.setAttribute("data-count",t.length)),d=app.virtualList.get(e)){var s=d.params.height,m=e.querySelector("ul li");if(m){var g=m.offsetHeight||0;g>0&&g!=s&&(d.params.height=g,d.update())}}n&&n.remove(),app.preloader.hide()}},gauge:{init:function(){for(var e=document.querySelectorAll(".gauge"),t=0;t<e.length;t++){var i=e[t];i.innerHTML="";var o=app.gauge.get(i);o&&app.gauge.destroy(i),o=app.gauge.create({el:i,type:i.getAttribute("data-gauge-type")||"circle",value:i.getAttribute("data-gauge-value")||"0.5",size:i.getAttribute("data-gauge-size")||"250",borderColor:i.getAttribute("data-border-color")||"#2196f3",borderWidth:i.getAttribute("data-border-width")||10,valueText:i.getAttribute("data-value-text")||"50%",valueFontSize:i.getAttribute("data-value-font-size")||41,borderBgColor:i.getAttribute("data-border-bg-color")||"#2196f3",valueFontWeight:i.getAttribute("data-value-font-weight")||"500",labelText:i.getAttribute("data-label-text")||"",valueTextColor:i.getAttribute("data-value-text-color")||"#000000",labelFontSize:i.getAttribute("data-label-font-size")||"14",labelFontWeight:i.getAttribute("data-label-font-weight")||"400",labelTextColor:i.getAttribute(" data-label-text-color")||"#888888"})}}},actionSheet:{show:function(e){var t=e.target.getAttribute("data-actionsheet-items"),i=JSON.parse(t),o=[],r=[],a=[];for(const[t,o]of Object.entries(i)){var n=o.label;n.includes("{")&&(n=thoriumapi.setDynamicVariableContent(n));o["link-type"],o.target;const t=o.islabel,i=o.group;var l={};l.text=n,l.label="true"==t,l.bold=!0,l.targetelement=o.target,l.onClick=function(){thoriumCorePlugin.actionSheet.callback(e,o)},'<div class="actions-button"><div class="actions-button-text">'+o.label+"</div></div>","true"==i?a.push(l):r.push(l)}o.push(r),a.length>0&&o.push(a),app.actions.create({buttons:o}).open(!0)},callback:function(e,t){if(e.preventDefault(),2==t["link-type"]){if(window.open(t.target,"_blank"),0==app.device.capacitor&&1==thoriumapi.isSafari())if(window&&window.webkit)if(window.webkit&&0==app.device.cordova&&0==app.device.capacitor&&window.webkit.messageHandlers)try{window.webkit.messageHandlers.thoriumHandler.postMessage(t.target)}catch(e){}e.stopImmediatePropagation()}else if(1==t["link-type"]){var i=t.target.replace(".html","");thoriumapi.loadpage(i,{},"f7-cover-v")}else if(15==t["link-type"]){var o=[];if(t.target){var r=t.target.replace("javascript:","").replace("()",""),a=window[r],n=[o];"function"==typeof a?(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] call function "+r),o=a.apply(this,n)):thoriumapi.logEvent(1,"[com.thoriumbuilder.core] function "+r+" does not exists")}}else if(13==parseInt(t["link-type"]))app.dialog.alert("close");else if(14==parseInt(t["link-type"]))app.dialog.confirm(kLogout+"?",(function(){auth.logout()}));else{if(!(parseInt(t["link-type"])<10))return;window.location.href=t.target}}},getMedialistLine:function(e,t){for(const[i,o]of Object.entries(e))t=t.replaceAll("{{"+i+"}}",o);return t},renderVirtualMediaListData:function(e,t){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Rendering Virtual List Data");var i=e.getAttribute("data-template")||null;if(!i)return $("#"+e.id).hide(),thoriumapi.logEvent(1,"[com.thoriumbuilder.core] No template defined"),void app.dialog.alert("[com.thoriumbuilder.core] No template defined");var o=e.getAttribute("data-height-ios")||104,r=e.getAttribute("data-height-md")||111,a=app.virtualList.create({el:e,items:t,createUl:!0,setListHeight:!0,searchAll:function(e,t){for(var i=[],o=0;o<t.length;o++){(JSON.stringify(t[o]).toLowerCase().indexOf(e.toLowerCase())>=0||""===e.trim())&&i.push(o)}return i},renderItem:e=>thoriumCorePlugin.getMedialistLine(e,i),height:"ios"===app.theme?o:"md"===app.theme?r:111}),n=a.$el[0];n&&(n.setAttribute("data-loaded",!0),n.setAttribute("data-count",t.length))},getVirtualMediaListData:function(e,t){var i=[],o=$("#"+e.id);if(o){var r=app.virtualList.get(o);r&&app.virtualList.destroy(r);var a="js/json/"+t;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Loading Virtual List Data from Json at ["+a+"]"),app.preloader.show(),fetch(a,{method:"get",headers:{"Content-type":"application/json"}}).then((function(t){t.json().then((t=>{thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Received Data from ["+a+"]");var o=0,r={};for(var n in t)(r=t[n]).dataindex=o,o+=1,i.push(r);thoriumCorePlugin.renderVirtualMediaListData(e,i),app.preloader.hide()})).catch((function(t){$("#"+e.id).hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+t.message+"] While loading data from ["+a+"]"),app.dialog.alert(t.message)}))})).catch((function(t){$("#"+e.id).hide(),app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+t.message+"]"),0==app.online?thoriumapi.showNotification("Internet connection lost"):app.dialog.alert(t.message)}))}},initVirtualMediaLists:function(){for(var e=document.querySelectorAll(".virtual-media-list"),t=0;t<e.length;t++){var i=e[t];if("true"!=i.getAttribute("data-loaded")&&"true"==i.getAttribute("data-virtual-list")){app.preloader.show();var o=i.getAttribute("data-json-source")||null;o&&thoriumCorePlugin.getVirtualMediaListData(i,o)}}},appLoaded:function(){var e=new Event("appLoaded"),t=setInterval((function(){app&&(clearInterval(t),document.dispatchEvent(e))}),100)},showPopover:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Popover");var t=e.getAttribute("data-content");t&&(thoriumCorePlugin.currentPopover=app.popover.create({targetEl:e,arrow:!0,verticalPosition:"bottom",backdrop:!0,closeByBackdropClick:!0,closeByOutsideClick:!0,closeOnEscape:!0,animate:!0,content:'<div class="popover"><div class="popover-inner">'+t+"</div></div>"}),thoriumCorePlugin.currentPopover.open())},webShare:function(e,t){if(e.preventDefault(),null==navigator.share)thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Web Share only possible with https web sites"),app.dialog.alert("Web Share only possible with https web sites");else{var i=t.attr("data-webshare-title")||app.name,o="",r=t.attr("data-webshare-imgref");if(r&&(o=$(r).attr("src")||""),1==o.includes("blob:"))return;var a="";a=o?i:t.attr("data-webshare-textref")||window.location.href,thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Call Navigator.share");try{navigator.share({title:i,url:o,text:a})}catch(e){app.dialog.alert("Web Share Error: "+e)}}},getText:function(e){if(e.childElementCount>0){for(var t="",i=0;i<e.childNodes.length;++i){e.childNodes[i].nodeType===Node.TEXT_NODE&&(t+=e.childNodes[i].textContent)}return t}return e.textContent},initAllAutoComplete:function(){for(var e=document.querySelectorAll(".autocomplete"),t=0;t<e.length;t++){var i=e[t],o=i.getAttribute("data-autocomplete")||null;if(o&&o.length>0){var r=o.split(",");autocompleteDropdownSimple=app.autocomplete.create({inputEl:i,openIn:"dropdown",source:function(e,t){var i=[];if(0!==e.length){for(var o=0;o<r.length;o++)r[o].toLowerCase().indexOf(e.toLowerCase())>=0&&i.push(r[o]);t(i)}else t(i)}})}}},uploadFileRead:function(e,t){var i=t.getAttribute("data-resize")||800;if(1==("true"==t.getAttribute("data-postfile")||!1)&&e){var o=t.accept.toLowerCase(),r=e.type.toLowerCase(),a=e.name.split(".").pop().toLowerCase();if(1==o.includes("audio")){if(0==r.includes("audio"))return void app.dialog.alert(e.name+" is not a valid Audio file")}else if(1==o.includes("video")){if(0==r.includes("video"))return void app.dialog.alert(e.name+" is not a valid Video file")}else if(1==o.includes("image")){if(0==r.includes("image"))return void app.dialog.alert(e.name+" is not a valid Image file")}else if(0==o.includes(a))return void app.dialog.alert(e.name+" is not a valid "+o+" file");$("#"+t.id).data("data-blob",e),$("#"+t.id+"-filename").text(e.name);var n=t.id.replace("-fileinput","");return $("#"+n+"-remove")&&$("#"+n+"-remove").show(),$("#"+n+"-fileinput-filename").css("visibility","visible"),$("#"+n+"-fileinput-filename").html('<i class="fa f7-icons">paperclip</i><span>'+e.name+"</span>"),$("#"+n+"-fileinput-filename").show(),void $("#"+n+"-fileinput").attr("data-modified","true")}var l=!1;1!=(o=t.accept.toLowerCase()).includes("image/png")&&1!=o.includes("image/jpeg")&&1!=o.includes("image/gif")&&1!=o.includes("image/*")||(l=!0);var u=(e.size/1024/1024).toFixed(4);if(1==l&&u>kImgMaxSize||0==l&&u>kDocMaxSize)app.dialog.alert("File too large (Max Size Allowed: "+kImgMaxSize+"Mb)");else if(l){if(!e.type.match(/image.*/))return void app.dialog.alert("The dropped file is not an image!");(c=new FileReader).onload=function(o){thoriumCorePlugin.resizeImage(e,i).then((function(i){var o=t.id.replace("-fileinput",""),r=thoriumCorePlugin.dataURItoBlob(i);r.name=e.name,thoriumCorePlugin.currentBlob=r,$("#"+o+"-fileinput").data("data-blob",i),$("#"+o+"-fileinput").data("data-type",r.type||"image/jpg"),$("#"+o+"-fileinput").data("data-filename",e.name),$("#"+o).css("background-image","url('"+i+"')"),$("#"+o+"-rotate")&&$("#"+o+"-rotate").css("display","block"),$("#"+o+"-remove")&&$("#"+o+"-remove").css("display","block"),$("#"+o+"-fileinput").attr("data-modified","true")}))},c.readAsDataURL(e)}else{var c;(c=new FileReader).onload=function(i){var o=t.id.replace("-fileinput",""),r=c.result;$("#"+o+"-fileinput").data("data-blob",r),$("#"+o+"-fileinput").data("data-type",t.type),$("#"+o+"-fileinput").data("data-filename",e.name),$("#"+o+"-remove")&&$("#"+o+"-remove").show(),$("#"+o+"-fileinput-filename").css("visibility","visible"),$("#"+o+"-fileinput-filename span").text(e.name),$("#"+o+"-fileinput-filename i").show(),$("#"+o+"-fileinput-filename").show(),$("#"+o+"-fileinput").attr("data-modified","true")},c.readAsDataURL(e)}},resizeImage:function(e,t){return new Promise((function(i,o){var r="x",a=new FileReader;a.onloadend=function(){var n=new Image;n.src=a.result,n.onload=function(){var o=n.width,a=n.height;o>a?o>t&&(a*=t/o,o=t):a>t&&(o*=t/a,a=t);var l=document.createElement("canvas");l.width=o,l.height=a,l.getContext("2d").drawImage(this,0,0,o,a);var u=e.type||"image/jpg";r=l.toDataURL(u),i(r)},n.onerror=function(e){o("Image Resize Error "+e)}},a.readAsDataURL(e)}))},rotateImage:function(e,t){return new Promise((function(i,o){var r=new Image;r.src=e,r.onload=function(){var e=r.width,o=r.height,a=document.createElement("canvas");a.width=e,a.height=o;var n=a.getContext("2d");a.width=o,a.height=e,(n=a.getContext("2d")).translate(o,0),n.rotate(90*Math.PI/180),n.drawImage(this,0,0,e,o),t=t||"image/jpg",dataURL=a.toDataURL(t),i(dataURL)},r.onerror=function(e){o("Unable to rotate Image "+e)}}))},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(t.length),r=new Uint8Array(o),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return new Blob([o],{type:i})},uploadFile:function(e,t,i,o,r,a){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Uploading file "+t+" to Firebase"),app.preloader.hide();var n=app.dialog.progress(""),l=(t=t.replace("C:\\fakepath\\","")).substr(t.lastIndexOf(".")+1),u=firebase.storage().ref().child(i+"/");t=r+"_"+o+"."+l;var c=thoriumCorePlugin.dataURItoBlob(e);u.child(t).put(c).catch((function(l){app.emit("onFirestoreUploadError",l,e,t,i,o,r,a),n.close(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Uploading file "+t+" to Firebase failed: "+l.message),app.preloader.hide(),app.dialog.alert(l.message)})).then((function(l){l.task.on("state_changed",(e=>{var t=e.bytesTransferred/e.totalBytes*100;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Upload is "+t+"% done"),n.setText(t+"%"),n.setProgress(t)}),(l=>{app.emit("onFirestoreUploadError",l,e,t,i,o,r,a),app.preloader.hide(),n.close(),thoriumapi.logEvent(2,"[com.thoriumbuilder.firestore] Error while uploading file: "+l.message),app.dialog.alert(l.message)}),(()=>{thoriumapi.logEvent(0,"[com.thoriumbuilder.firestore] file uploaded, retriveing information...: "),u.child(t).getDownloadURL().then((function(l){thoriumapi.logEvent(0,"[com.thoriumbuilder.firestore] updating file information..."),a.update({[r]:l}).catch((function(n){app.emit("onFirestoreUploadError",n,e,t,i,o,r,a),app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.firestore] Error while uploading file: "+n.message),app.dialog.alert("Error when updating Document: "+n.message)})),setTimeout((function(){app.emit("onFirestoreUploadSuccess",e,t,i,o,r,a),n.close(),thoriumapi.logEvent(0,"[com.thoriumbuilder.firestore] file uploaded succesfully")}),1e3)})).catch((function(l){app.emit("onFirestoreUploadError",l,e,t,i,o,r,a),n.close(),app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.firestore] Error when updating Document: "+l.message),app.dialog.alert("Error when updating Document: "+l.message)}))}))}))}};function showTextZoom(e){e.style.whiteSpace="break-spaces";var t=e.innerText,i=document.querySelector(".text-viewer-popup .block-text");i&&(i.innerText=t),app.sheet.create({el:".text-viewer-popup",swipeToClose:!1,backdrop:!0,closeByBackdropClick:!0,closeByOutsideClick:!0,closeOnEscape:!0,animate:!0}).open(!0),e.style.whiteSpace="normal"}$(document).on("mousedown","input[readonly]",(function(e){e.preventDefault()})),$(document).on("submit",".form",(function(e){var t=e.target.getAttribute("data-mode");if("0"==t||"1"==t||"2"==t)try{thoriumCorePlugin.forms.submitForm(e,e.target)}catch(e){app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Form error: "+e),app.dialog.alert("Form error: "+e)}})),$(document).on("click",".form-submit-button",(function(e){e.preventDefault();var t=this.getAttribute("data-form")||"",i=document.getElementById(t);i&&i.length>0&&i.dispatchEvent(new Event("submit",{bubbles:!0}))})),$(document).on("click","input[type='geo']",(function(e){e.preventDefault();var t=$("#"+e.target.id).data("pos");if(t){var i="https://www.google.com/maps/search/?api=1&query="+t.coords.latitude+","+t.coords.longitude;window.location=i}})),$(document).on("click",".dynamic-action-sheet",(function(e){e.preventDefault,thoriumCorePlugin.actionSheet.show(e)})),$(document).on("click","a[href^=mailto],a[href^=tel],a[href^=sms],a[href^=skype],a[href^=facetime]",(function(e){if(1==app.device.webView&&1==app.device.ios){e.preventDefault();var t=this.getAttribute("href");return t&&(window.location=t),!1}})),$(document).on("click",".virtual-list .link",(function(e){e.stopPropagation(),e.stopImmediatePropagation()})),$(document).on("dragenter",".firebase_document_preview , .firebase_fileupload-dropzone ",(function(e){e.preventDefault(),this.style.opacity=.5})),$(document).on("dragover",".firebase_document_preview , .firebase_fileupload-dropzone",(function(e){return e.preventDefault(),this.style.opacity=.5,!1})),$(document).on("dragover",".firebase_document_input",(function(e){e.preventDefault();for(var t=document.querySelectorAll(".firebase_fileupload-dropzone"),i=0;i<t.length;i++)t[i].style.opacity=.5})),$(document).on("dragleave",".firebase_document_preview , .firebase_fileupload-dropzone",(function(e){e.preventDefault();for(var t=document.querySelectorAll(".firebase_fileupload-dropzone"),i=0;i<t.length;i++)t[i].style.opacity=1})),$(document).on("click",".firebase_document_preview, .firebase_fileupload-dropzone",(function(e){e.preventDefault(),app.tooltip.hide(".firebase_document_input")})),$(document).on("click",".form-img-add-btn",(function(e){1==thoriumapi.isLocal()&&(app.device.ios||app.device.android)&&app.dialog.alert("Function not available in simulator, use drag&drop instead")})),$(document).on("click",".firebase_document_input",(function(e){(app.tooltip.hide(".firebase_document_input"),1==thoriumapi.isLocal()&&(app.device.ios||app.device.android))&&app.tooltip.create({targetEl:this,text:"Drop your file here"}).show()})),$(document).on("click",".firebase_fileupload-rotate",(function(e){e.preventDefault();var t=$(this).attr("data-fileinput-ref"),i=$("#"+t),o=$("#"+t+"-fileinput");if(i&&o){var r=o.data("data-blob"),a=o.data("data-type");app.preloader.show(),setTimeout((function(){thoriumCorePlugin.rotateImage(r,a).then((function(e){app.preloader.hide(),i.css("background-image","url("+e+")"),o.data("data-blob",e)})).catch((function(e){app.preloader.hide(),app.dialog.alert("Error image: "+e.message)}))}),500)}})),$(document).on("drop",".firebase_document_preview , .firebase_fileupload-dropzone",(function(e){e.preventDefault(),this.style.opacity=1;var t=document.getElementById(e.target.id+"-fileinput");thoriumCorePlugin.uploadFileRead(e.dataTransfer.files[0],t),e.stopPropagation()})),$(document).on("drop",".firebase_document_input",(function(e){e.preventDefault();var t=document.querySelector(".firebase_fileupload-dropzone");t&&(t.style.opacity=1),thoriumCorePlugin.uploadFileRead(e.dataTransfer.files[0],this)})),$(document).on("change",".firebase_document_input",(function(e){e.preventDefault(),thoriumCorePlugin.uploadFileRead(e.target.files[0],e.target)})),$(document).on("click",".firebase_fileupload-remove",(function(e){e.preventDefault();var t=$(this),i=t.attr("data-fileinput-ref");$("#"+i)&&app.dialog.confirm("Remove file?",(function(){$("#"+i+"-fileinput").data("data-blob",null),$("#"+i+"-fileinput").data("data-type",null),$("#"+i).attr("data-clear",!0),$("#"+i+"-fileinput").data("data-filename",null),$("#"+i+"-fileinput-filename").css("visibility","hidden"),$("#"+i+"-fileinput-filename span").text(""),$("#"+i+"-fileinput-filename i").hide(),$("#"+i).css("background-image",""),$("#"+i+"-rotate")&&$("#"+i+"-rotate").hide(),$("#"+i+"-fileinput").attr("data-modified","true"),t.hide()}))})),$(document).on("click","#tb_debug_log",(function(e){e.preventDefault();var t=app.sheet.get(".debug-popup");if(t)1==t.opened?t.close():t.open();else{(t=app.sheet.create({el:".debug-popup",swipeToClose:!1,backdrop:!0,closeByBackdropClick:!0,closeByOutsideClick:!1,closeOnEscape:!0,animate:!0})).open(!0);var i=document.querySelector(".debug-popup .debug-log");i&&(i.scrollTop=i.scrollHeight)}})),$(document).on("click",".btncloseinfowindow",(function(e){e.preventDefault(),element=document.querySelector(".custominfowindow"),element&&(element.style.display="none")})),$(document).on("click",".webshare",(function(e){thoriumCorePlugin.webShare(e,$(this))})),$(document).on("click",".img-zoom",(function(e){if(1==this.classList.contains("dbexpress-image")&&"object"==typeof dbExpressData){var t=this.closest(".dbexpress-virtual-list-content");if(t)return void dbExpressData.showVerticalRepeaterZoom(t,this)}thoriumCorePlugin.photobrowser.showImageZoom(e),e.stopPropagation(),e.stopImmediatePropagation()})),$(document).on("click",".collection-item-zoom",(function(e){thoriumCorePlugin.photobrowser.showCollectionZoom(this,e)})),$(document).on("click",".medialist-zoom",(function(e){thoriumCorePlugin.photobrowser.showMedialistZoom(this,e)})),$(document).on("click",".card-opened",(function(e){e.preventDefault,app.card.close($(this),!0)})),$(document).on("click",".dynamic-popover",(function(e){e.preventDefault,thoriumCorePlugin.showPopover(this)})),$(document).on("click",".popover li a",(function(e){null!=thoriumCorePlugin.currentPopover&&app.popover.close(thoriumCorePlugin.currentPopover.el,!0)})),$(document).on("click",".segmented .button",(function(e){$(this).closest(".segmented").children(".button-active").removeClass("button-active");$(this).addClass("button-active")})),$(document).on("mouseover","* [data-transform-trigger='mouseover']",(function(e){thoriumCorePlugin.effects.execute(this)})),$(document).on("mouseout","* [data-transform-trigger='mouseover']",(function(e){thoriumCorePlugin.effects.reset(this)})),$(document).on("click","* [data-transform-trigger='mouseclick']",(function(e){var t=$(this).attr("data-transform-effect")||"";this.style.transform=t})),document.addEventListener("scroll",(function(e){var t=e.target;thoriumCorePlugin.effects.scrolleffect(t)}),!0),$(document).on("click","* [data-translate-language]",(function(e){var t=e.target.getAttribute("data-translate-language")||null,i=e.target.getAttribute("data-translate-direction")||null;1==kMultilingual&&thoriumCorePlugin.translations.translate(t,i)})),app.on("offline",(function(){thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Internet connection lost")})),app.on("online",(function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Internet connection back")})),$(document).on("change",".capture_button input",(function(e){if(e.preventDefault(),e.target.files){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Media Capture in Progress...");var t=e.target.files[0],i=(URL.createObjectURL(t),this.getAttribute("accept"));if("image/*"==i)(o=new FileReader).addEventListener("load",(function(){var t=e.target.closest(".capture_button");app.emit("captureSuccess",t,o.result)}),!1),t&&o.readAsDataURL(t);else if("video/*"==i){var o;(o=new FileReader).onload=function(t){var i=t.target.result,o=new Blob([new Uint8Array(i)],{type:"video/mp4"}),r=window.URL.createObjectURL(o),a=e.target.closest(".capture_button");app.emit("captureSuccess",a,r)},t&&o.readAsArrayBuffer(t)}else thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Capture Button Media Type not set")}})),$(document).on("click",".capture_button",(function(e){(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Capture Button Click event"),1==thoriumapi.isLocal()&&(app.device.ios||app.device.android))&&(app.tooltip.create({targetEl:this,text:"Function not available with the Simulator"}).show(),thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Capture Buttons doesn't work in Simulator"))})),$(document).on("click",".container-link",(function(e,t){e.preventDefault,e.stopImmediatePropagation();var i=this.getAttribute("data-container-link"),o=this.getAttribute("data-container-link-type");if(i)if(2==o){this.getAttribute("data-container-target");if(window.open(i,"_blank"),0==app.device.capacitor&&1==thoriumapi.isSafari())if(window&&window.webkit)if(window.webkit&&0==app.device.cordova&&0==app.device.capacitor&&window.webkit.messageHandlers)try{window.webkit.messageHandlers.thoriumHandler.postMessage(i)}catch(e){}e.stopImmediatePropagation()}else if(1==o){var r=this.getAttribute("data-container-transition")||"";i=i.replace(".html",""),thoriumapi.loadpage(i,{},r)}else window.location.href=i})),$(document).on("click",".container-link a",(function(e,t){e.preventDefault,e.stopImmediatePropagation()})),$(document).on("tab:show",".tab",(function(e){if(app.emit("tabShow",this),"undefined"!=typeof openStreetMapPlugin)for(var t=this.querySelectorAll(".openstreetmap-api"),i=0;i<t.length;i++){var o=t[i],r=document.getElementById(o.id);r&&r.data&&(r.data.invalidateSize(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Refresh OSM Map with ID ["+o.id+"]"))}for(t=this.querySelectorAll(".virtual-list"),i=0;i<t.length;i++){o=t[i];var a=app.virtualList.get(o);if(a){var n=a.params.height,l=o.querySelector("li");if(l){var u=l.offsetHeight||0;u>0&&u!=n&&(a.params.height=u,a.update())}}}})),$(window).on("resize",(function(e){thoriumCorePlugin.app.resize()})),$(document).on("click",".text-viewer",(function(e){e.preventDefault(),showTextZoom(this)})),$(document).on("click",".text-viewer-popup .text-viewer-bigger",(function(e){e.preventDefault();var t=document.querySelector(".text-viewer-popup .block-text");if(t){var i=parseInt(t.style.fontSize)||22;i+=1,t.style.fontSize=i+"px"}})),$(document).on("click",".text-viewer-popup .text-viewer-smaller",(function(e){e.preventDefault();var t=document.querySelector(".text-viewer-popup .block-text");if(t){var i=parseInt(t.style.fontSize)||17;(i-=1)<=8&&(i=8),t.style.fontSize=i+"px"}})),$(document).on("click","input[data-number-input-type='2']",(function(e){e.preventDefault(),app.keypad.create({inputEl:e.target,backdrop:!0,type:"calculator",toolbar:!1}).open()})),$(document).on("click","input[data-number-input-type='1']",(function(e){e.preventDefault(),app.keypad.create({inputEl:e.target,backdrop:!0,type:"numpad",toolbar:!1}).open()})),$(document).on("page:afterin",".page",(function(e,t){if("index"!=t.name&&"backward"!=t.direction&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Page "+t.name+" is loaded"),1!=app.device.cordova&&1!=app.device.capacitor||$(".webshare").hide(),1!=app.device.cordova&&1!=app.device.capacitor||1!=app.device.ios||($(".page-current .page-content").css("overflow-y","hidden"),setTimeout((function(){$(".page-current .page-content").css("overflow-y","auto")}),200)),thoriumCorePlugin.effects.init()),"index"==t.name){var i=document.querySelector(".page-content");i&&setTimeout((function(){"backward"==t.direction&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] back to Index"),i.style.overflowY="scroll",document.documentElement.style.overflowY="hidden",document.body.overflowY="hidden",app.preloader.hide()}),200)}})),$(document).on("page:beforeout",(function(e){var t=e.detail;if($(".custominfowindow").hide(),"backward"!=t.direction){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Page "+t.name+" will close (beforeout)");for(var i=document.querySelectorAll(".audio"),o=0;o<i.length;o++){var r=i[o];r&&r.pause()}}})),$(document).on("page:beforein",(function(e){var t=e.detail;if("backward"!=t.direction){if(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Page "+t.name+" will open (beforein)"),$(".custominfowindow").hide(),1==kAutoClosePanels){var i=app.panel.get("#panel-left");i&&i.close(!0);var o=app.panel.get("#panel-right");o&&o.close(!0)}for(var r=document.querySelectorAll(".audio"),a=0;a<r.length;a++){var n=r[a];n&&n.pause()}}})),$(document).on("page:mounted",(function(e){var t=e.detail;"index"!=t.name&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Page "+t.name+" is mounted"),1==kMultilingual&&thoriumCorePlugin.translations.translate(),thoriumCorePlugin.swiper.init(),thoriumCorePlugin.calendars.init(),thoriumCorePlugin.timepicker.init(),thoriumCorePlugin.texteditor.init(),thoriumCorePlugin.app.pullToRefreshHandle(e),thoriumCorePlugin.forms.init(e),thoriumCorePlugin.initVirtualMediaLists(),thoriumCorePlugin.gauge.init(),thoriumCorePlugin.initAllAutoComplete())})),app.on("pageInit",(function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] page:init event")})),app.on("pageReinit",(function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] page:reinit event"),thoriumCorePlugin.calendars.init()})),app.on("pageBeforein",(function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] page:beforein event")})),app.on("pageAfterin",(function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] page:afterin event")})),app.on("pageBeforeout",(function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] page:beforeout event")})),app.on("pageAfterout",(function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] page:afterout event")})),app.on("pageBeforeunmount",(function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] page:beforeunmount event")})),app.on("pageBeforeremove",(function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] page:beforeremove event")})),window.onerror=function(e,t,i,o){return thoriumapi.handleError(e,t,i,o),!1},document.addEventListener("deviceready",thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Device Ready")),document.addEventListener("DOMContentLoaded",thoriumapi.logEvent(0,"[com.thoriumbuilder.core] DOM Content Loaded")),document.addEventListener("appLoaded",(function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Application dependencies Loaded"),thoriumCorePlugin.app.init(),app.emit("appLoaded",e),setTimeout((function(){thoriumCorePlugin.app.showAppLoader(!1)}),1e3)}),!1);