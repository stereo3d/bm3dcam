/**
 * Framework7 Plugin Keypad 0.0.0
 * Keypad plugin extends Framework7 with additional custom keyboards
 * http://framework7.io/plugins/
 *
 * Copyright 2014-2022 Vladimir Kharlampidi
 *
 * Released under the MIT License
 *
 * Released on: April 19, 2022
 */

!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(e="undefined"!=typeof globalThis?globalThis:e||self).Framework7Keypad=a()}(this,(function(){"use strict";let e;return{name:"keypad",install(){var a;a=this.Class,e=class e extends a{constructor(a,t){super(t,[a]);const n=a.utils,s=a.$,l=a.request,o=this;o.app=a;const p=n.extend({on:{}},a.params.keypad);let r,u,c,i,d,m,h,v;if(o.params=n.extend(p,t),o.params.containerEl&&(r=s(o.params.containerEl),0===r.length))return o;if(!o.params.buttons||0===o.params.buttons.length){const{dotCharacter:e,dotButton:a}=o.params;"numpad"===o.params.type?o.params.buttons=[{html:'<span class="keypad-button-number">1</span><span class="keypad-button-letters"></span>',value:1},{html:'<span class="keypad-button-number">2</span><span class="keypad-button-letters">ABC</span>',value:2},{html:'<span class="keypad-button-number">3</span><span class="keypad-button-letters">DEF</span>',value:3},{html:'<span class="keypad-button-number">4</span><span class="keypad-button-letters">GHI</span>',value:4},{html:'<span class="keypad-button-number">5</span><span class="keypad-button-letters">JKL</span>',value:5},{html:'<span class="keypad-button-number">6</span><span class="keypad-button-letters">MNO</span>',value:6},{html:'<span class="keypad-button-number">7</span><span class="keypad-button-letters">PQRS</span>',value:7},{html:'<span class="keypad-button-number">8</span><span class="keypad-button-letters">TUV</span>',value:8},{html:'<span class="keypad-button-number">9</span><span class="keypad-button-letters">WXYZ</span>',value:9},{html:a?`<span class="keypad-button-number">${e}</span>`:"",value:a?e:void 0,dark:!0,cssClass:a?"":"keypad-dummy-button"},{html:'<span class="keypad-button-number">0</span>',value:0},{html:'<i class="icon icon-keypad-delete"></i>',cssClass:"keypad-delete-button",dark:!0}]:"calculator"===t.type&&(o.params.buttons=[{html:'<span class="keypad-button-number">C</span>',value:"C",dark:!0},{html:'<span class="keypad-button-number">±</span>',value:"±",dark:!0},{html:'<span class="keypad-button-number">%</span>',value:"%",dark:!0},{html:'<span class="keypad-button-number">÷</span>',value:"÷",cssClass:"calc-operator-button"},{html:'<span class="keypad-button-number">7</span>',value:7},{html:'<span class="keypad-button-number">8</span>',value:8},{html:'<span class="keypad-button-number">9</span>',value:9},{html:'<span class="keypad-button-number">×</span>',value:"×",cssClass:"calc-operator-button"},{html:'<span class="keypad-button-number">4</span>',value:4},{html:'<span class="keypad-button-number">5</span>',value:5},{html:'<span class="keypad-button-number">6</span>',value:6},{html:'<span class="keypad-button-number">-</span>',value:"-",cssClass:"calc-operator-button"},{html:'<span class="keypad-button-number">1</span>',value:1},{html:'<span class="keypad-button-number">2</span>',value:2},{html:'<span class="keypad-button-number">3</span>',value:3},{html:'<span class="keypad-button-number">+</span>',value:"+",cssClass:"calc-operator-button"},{html:'<span class="keypad-button-number">0</span>',value:0,cssClass:"keypad-button-double"},{html:'<span class="keypad-button-number">.</span>',value:e},{html:'<span class="keypad-button-number">=</span>',value:"=",cssClass:"calc-operator-button calc-operator-button-equal"}])}function y(){o.open()}function b(e){e.preventDefault()}function k(e){const a=s(e.target);o.isPopover()||o.opened&&(a.closest('[class*="backdrop"]').length||(u&&u.length>0?a[0]!==u[0]&&0===a.closest(".sheet-modal, .keypad-modal").length&&o.close():0===s(e.target).closest(".sheet-modal, .keypad-modal").length&&o.close()))}function f(e){if(0===e.length)return;const a=o.params.buttons[e.index()];let t=a.value,n=o.value;"numpad"===o.params.type&&(void 0===n&&(n=""),e.hasClass("keypad-delete-button")?n=n.substring(0,n.length-1):void 0!==t&&("."===t&&n.indexOf(".")>=0&&(t=""),n+=t),void 0!==n&&o.setValue(n)),"calculator"===o.params.type&&(o.calculator(a.value),o.$el.find(".keypad-buttons").find(".calc-operator-active").removeClass("calc-operator-active"),e.hasClass("calc-operator-button")&&!e.hasClass("calc-operator-button-equal")&&e.addClass("calc-operator-active")),o.emit("local::buttonClick keypadButtonClick",o,a),a.onClick&&a.onClick(o,a)}function g(e){const a=s(e.target).closest(".keypad-button");a.length&&f(a)}function $(e){if(d||m)return;const a=s(e.target).closest(".keypad-button");a.length&&(i=a,d=!0,h=e.targetTouches[0].pageX,v=e.targetTouches[0].pageY)}function O(e){if(!d)return;const a=(e.targetTouches[0]||e.changedTouches[0]).pageX,t=(e.targetTouches[0]||e.changedTouches[0]).pageY;(Math.abs(a-h)>10||Math.abs(t-v)>10)&&(m=!0)}function E(){if(d){if(m)return d=!1,void(m=!1);d=!1,m=!1,f(i)}}return o.params.inputEl&&(u=s(o.params.inputEl)),c=o.params.view?o.params.view:u&&u.length?u.parents(".view").length&&u.parents(".view")[0].f7View:a.views.get(u),c||(c=a.views.main),n.extend(o,{app:a,request:l,$containerEl:r,containerEl:r&&r[0],inline:r&&r.length>0,$inputEl:u,inputEl:u&&u[0],initialized:!1,opened:!1,view:c,url:o.params.url,calcValues:[],calcOperations:[],lastWasNumber:!1}),n.extend(o,{attachInputEvents(){o.$inputEl.on("click",y),o.params.inputReadOnly&&o.$inputEl.on("focus mousedown",b)},detachInputEvents(){o.$inputEl.off("click",y),o.params.inputReadOnly&&o.$inputEl.off("focus mousedown",b)},attachHtmlEvents(){a.on("click",k)},detachHtmlEvents(){a.off("click",k)}}),o.attachKeypadEvents=function(){const e=o.$el.find(".keypad-buttons");a.support.touch?(e.on(a.touchEvents.start,$),a.on("touchmove",O),a.on("touchend",E)):e.on("click",g),o.detachKeypadEvents=function(){a.support.touch?(e.off(a.touchEvents.start,$),a.off("touchmove",O),a.off("touchend",E)):e.off("click",g)}},u&&u.length&&(u[0].f7Keypad=e),r&&r.length&&(r[0].f7Keypad=e),o.init(),o}initInput(){const e=this;e.$inputEl&&e.params.inputReadOnly&&e.$inputEl.prop("readOnly",!0)}isPopover(){const e=this,{app:a,modal:t,params:n}=e;if("sheet"===n.openIn)return!1;if(t&&"popover"!==t.type)return!1;if(!e.inline&&e.inputEl){if("popover"===n.openIn)return!0;if(a.device.ios)return!!a.device.ipad;if(a.width>=768)return!0}return!1}calculator(e){const a=this,t="+ - = × ÷ ± %".split(" ");function n(){let e="";for(let n=0;n<a.calcOperations.length;n+=1){let s=a.calcOperations[n];n===a.calcOperations.length-1&&t.indexOf(s)>=0||s&&("."===s&&(s=0),e+=`${s.toString()}`.replace("×","*").replace("÷","/"))}e=e.replace(/--/g,"+"),a.setValue(eval.call(window,e))}if(a.value||(a.value=0),"C"===e)return a.setValue(0),a.calcValues=[],void(a.calcOperations=[]);if([0,1,2,3,4,5,6,7,8,9,"."].indexOf(e)>=0){if("."===e&&a.lastWasNumber&&a.value.toString().indexOf(".")>=0)return;t.indexOf(a.calcValues[a.calcValues.length-1])>=0?a.setValue(e):a.setValue(a.value?`${a.value}${e}`:e),a.lastWasNumber=!0}if(t.indexOf(e)>=0)if("±"===e){if("."===a.value)return;a.setValue(-1*a.value),a.lastWasNumber=!0}else if("%"===e){if(a.calcOperations[a.calcOperations.length-2]){const e=a.value/100;a.setValue(a.calcOperations[a.calcOperations.length-2]*e)}a.lastWasNumber=!0}else{const t=a.calcOperations[a.calcOperations.length-1];if("="===e){if("="===a.calcOperations[a.calcOperations.length-1]){if(a.calcOperations.length<2)return;a.calcOperations.pop();const e=a.calcOperations[a.calcOperations.length-2],t=a.calcOperations[a.calcOperations.length-1];a.calcOperations.push(e),a.calcOperations.push(t)}else a.calcOperations.push(a.value);a.calcOperations.push("="),n()}else["-","+","×","÷","="].indexOf(t)>=0?("="===t&&(a.calcOperations=[a.value,e]),["-","+","×","÷"].indexOf(t)>=0&&(a.lastWasNumber?["-","+"].indexOf(t)>=0&&["×","÷"].indexOf(e)>=0?(a.calcOperations.push(a.value),a.calcOperations.push(e)):(a.calcOperations.push(a.value),a.calcOperations.push(e),n()):a.calcOperations[a.calcOperations.length-1]=e)):(a.calcOperations.push(a.value),a.calcOperations.push(e),n());a.lastWasNumber=!1}"±"!==e&&"%"!==e&&a.calcValues.push(e)}formatValue(e){const a=this;return a.params.formatValue?a.params.formatValue.call(a,e):e}setValue(e){this.updateValue(e)}getValue(){return this.value}updateValue(e){const a=this;a.value=e,a.params.valueMaxLength&&a.value.length>a.params.valueMaxLength&&(a.value=a.value.substring(0,a.params.valueMaxLength)),a.emit("local::change keypadChange",a,a.value),a.$inputEl&&a.$inputEl.length>0&&(a.$inputEl.val(a.formatValue(a.value)),a.$inputEl.trigger("change"))}renderButtons(){const e=this;let a,t,n="";for(let s=0;s<e.params.buttons.length;s+=1)t=e.params.buttons[s],a="keypad-button",t.dark&&(a+=" keypad-button-dark"),t.cssClass&&(a+=` ${t.cssClass}`),n+=`<span class="${a}">${t.html||""}</span>`;return n}renderToolbar(){const e=this;return e.params.renderToolbar?e.params.renderToolbar.call(e,e):`\n        <div class="toolbar">\n          <div class="toolbar-inner">\n            <div class="left"></div>\n            <div class="right">\n              <a href="#" class="link sheet-close popover-close">${e.params.toolbarCloseText}</a>\n            </div>\n          </div>\n        </div>\n      `.trim()}renderSheet(){const e=this;if(e.params.renderSheet)return e.params.renderSheet.call(e,e);const{cssClass:a,toolbar:t}=e.params;return`\n        <div class="sheet-modal keypad keypad-sheet keypad-type-${e.params.type} ${a||""}">\n          ${t?e.renderToolbar():""}\n          <div class="sheet-modal-inner keypad-buttons">\n            ${e.renderButtons()}\n          </div>\n        </div>\n      `}renderPopover(){const e=this;if(e.params.renderPopover)return e.params.renderPopover.call(e,e);const{cssClass:a,toolbar:t}=e.params;return`\n        <div class="popover keypad-popover">\n          <div class="popover-inner">\n            <div class="keypad keypad-type-${e.params.type} ${a||""}">\n              ${t?e.renderToolbar():""}\n              <div class="keypad-buttons">\n                ${e.renderButtons()}\n              </div>\n            </div>\n          </div>\n        </div>\n      `.trim()}renderInline(){const e=this;if(e.params.renderInline)return e.params.renderInline.call(e,e);const{cssClass:a,toolbar:t}=e.params;return`\n        <div class="keypad keypad-inline keypad-type-${e.params.type} ${a||""}">\n          ${t?e.renderToolbar():""}\n          <div class="keypad-buttons">\n            ${e.renderButtons()}\n          </div>\n        </div>\n      `}render(){const e=this,{params:a}=e;if(a.render)return a.render.call(e);if(!e.inline){let t=a.openIn;if("auto"===t&&(t=e.isPopover()?"popover":"sheet"),"popover"===t)return e.renderPopover();if("sheet"===t)return e.renderSheet()}return e.renderInline()}onOpen(){const e=this,{initialized:a,$el:t,app:n,$inputEl:s,inline:l,value:o,params:p}=e;e.opened=!0,e.attachKeypadEvents(),a?o&&e.setValue(o):o?e.setValue(o):p.value&&e.setValue(p.value),!l&&s.length&&"md"===n.theme&&s.trigger("focus"),e.initialized=!0,t&&t.trigger("keypad:open",e),s&&s.trigger("keypad:open",e),e.emit("local::open keypadOpen",e)}onOpened(){const e=this;e.$el&&e.$el.trigger("keypad:opened",e),e.$inputEl&&e.$inputEl.trigger("keypad:opened",e),e.emit("local::opened keypadOpened",e)}onClose(){const e=this,a=e.app;e.$inputEl&&"md"===a.theme&&e.$inputEl.trigger("blur"),e.detachKeypadEvents&&e.detachKeypadEvents(),e.$el&&e.$el.trigger("keypad:close",e),e.$inputEl&&e.$inputEl.trigger("keypad:close",e),e.emit("local::close keypadClose",e)}onClosed(){const e=this;e.opened=!1,e.inline||e.app.utils.nextTick((()=>{e.modal&&e.modal.el&&e.modal.destroy&&(e.params.routableModals||e.modal.destroy()),delete e.modal})),e.$el&&e.$el.trigger("keypad:closed",e),e.$inputEl&&e.$inputEl.trigger("keypad:closed",e),e.emit("local::closed keypadClosed",e)}open(){const e=this,{app:a,opened:t,inline:n,$inputEl:s,params:l}=e;if(t)return;if(n)return e.$el=a.$(e.render()),e.$el[0].f7Keypad=e,e.$containerEl.append(e.$el),e.onOpen(),void e.onOpened();let o=l.openIn;"auto"===o&&(o=e.isPopover()?"popover":"sheet");const p=e.render(),r={targetEl:s,scrollToEl:e.params.scrollToInput?s:void 0,content:p,backdrop:void 0===e.params.backdrop?"sheet"!==o:e.params.backdrop,on:{open(){const a=this;e.modal=a,e.$el="popover"===o?a.$el.find(".keypad"):a.$el,e.$el[0].f7Keypad=e,e.onOpen()},opened(){e.onOpened()},close(){e.onClose()},closed(){e.onClosed()}}};e.params.routableModals?e.view.router.navigate({url:e.url,route:{path:e.url,[o]:r}}):(e.modal=a[o].create(r),e.modal.open())}close(){const e=this,{opened:a,inline:t}=e;if(a)return t?(e.onClose(),void e.onClosed()):void(e.params.routableModals?e.view.router.back():e.modal.close())}init(){const e=this;if(e.initInput(),e.inline)return e.open(),void e.emit("local::init keypadInit",e);!e.initialized&&e.params.value&&e.setValue(e.params.value),e.$inputEl&&e.attachInputEvents(),e.params.closeByOutsideClick&&e.attachHtmlEvents(),e.emit("local::init keypadInit",e)}destroy(){const e=this;if(e.destroyed)return;const{$el:a}=e;e.emit("local::beforeDestroy keypadBeforeDestroy",e),a&&a.trigger("keypad:beforedestroy",e),e.close(),e.$inputEl&&e.detachInputEvents(),e.params.closeByOutsideClick&&e.detachHtmlEvents(),a&&a.length&&delete e.$el[0].f7Keypad,e.app.utils.deleteProps(e),e.destroyed=!0}},this.Keypad=e},params:{keypad:{type:"numpad",openIn:"auto",backdrop:void 0,inputEl:null,containerEl:null,value:null,valueMaxLength:null,dotButton:!0,dotCharacter:".",buttons:[],closeByOutsideClick:!0,scrollToInput:!0,inputReadOnly:!0,onlyInPopover:!1,cssClass:null,toolbar:!0,toolbarCloseText:"Done",routableModals:!0,view:null,url:"select/",renderToolbar:null,renderPopover:null,renderSheet:null,renderInline:null,render:null}},create(){const a=this,t=a.$;a.keypad={create:t=>new e(a,t),get(a=".keypad"){if(a instanceof e)return a;const n=t(a);return 0!==n.length?n[0].f7Keypad:void 0},destroy(e=".keypad"){const t=a.keypad.get(e);if(t&&t.destroy)return t.destroy()},close(e=".keypad"){const a=t(e);if(0===a.length)return;const n=a[0].f7Keypad;!n||n&&!n.opened||n.close()}}},on:{pageInit(e){const a=e.app.$,t=e.app;e.$el.find('input[type="numpad"], input[type="calculator"]').each((e=>{const n=a(e),s={inputEl:e,type:n.attr("type"),value:n.val()||0};n.attr("maxlength")&&(s.valueMaxLength=n.attr("maxlength")),t.keypad.create(t.utils.extend(s,n.dataset()))}))},pageBeforeRemove(e){e.$el.find('input[type="numpad"], input[type="calculator"]').each((a=>{e.app.keypad.destroy(a)}))}}}}));
//# sourceMappingURL=framework7-keypad.min.js.map